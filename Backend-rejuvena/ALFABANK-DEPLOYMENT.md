# ‚úÖ –î–µ–ø–ª–æ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ –∑–∞–≤–µ—Ä—à–µ–Ω

**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026  
**–°–µ—Ä–≤–µ—Ä:** 37.252.20.170 (api-rejuvena.duckdns.org)

## üéâ –ß—Ç–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ:

### 1. **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
- ‚úÖ `/var/www/rejuvena-backend/src/models/Payment.model.ts`
- ‚úÖ `/var/www/rejuvena-backend/src/services/alfabank.service.ts`
- ‚úÖ `/var/www/rejuvena-backend/src/routes/payment.routes.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `/var/www/rejuvena-backend/src/server.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `/var/www/rejuvena-backend/src/models/User.model.ts`

### 2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):**
```env
# Alfabank Payment Gateway (TEST)
ALFABANK_USERNAME=r-seplitza-api
ALFABANK_PASSWORD=seplitza*?1
ALFABANK_API_URL=https://web.rbsuat.com/ab/rest
ALFABANK_RETURN_URL=https://seplitza.github.io/rejuvena/exercises/payment/success
ALFABANK_FAIL_URL=https://seplitza.github.io/rejuvena/exercises/payment/fail
FRONTEND_URL=https://seplitza.github.io/rejuvena/exercises
```

### 3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è `payments` —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ú–æ–¥–µ–ª—å User –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–¥–æ–±–∞–≤–ª–µ–Ω—ã isPremium, premiumEndDate)

### 4. **–°–µ—Ä–≤–µ—Ä:**
- ‚úÖ –ö–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω (npm run build)
- ‚úÖ PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- ‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 9527
- ‚úÖ –°—Ç–∞—Ç—É—Å: online

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ API endpoints:

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/payment/create` | –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (—Ç—Ä–µ–±—É–µ—Ç auth) |
| GET | `/api/payment/status/:paymentId` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (—Ç—Ä–µ–±—É–µ—Ç auth) |
| GET | `/api/payment/history` | –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (—Ç—Ä–µ–±—É–µ—Ç auth) |
| POST | `/api/payment/webhook` | Webhook –æ—Ç –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞ |
| GET | `/api/payment/callback` | Callback –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (—á–µ—Ä–µ–∑ API):

```bash
# 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
TOKEN=$(curl -s -X POST https://api-rejuvena.duckdns.org/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"your@email.com","password":"password"}' | jq -r '.token')

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
curl -X POST https://api-rejuvena.duckdns.org/api/payment/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "amount": 990,
    "description": "–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π",
    "planType": "premium",
    "duration": 30
  }'
```

### –î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

1. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã** (—Å–º. `docs/frontend/payment-integration-example.tsx`)
2. **–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞** (`/payment/success`)
3. **–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—à–∏–±–∫–∏** (`/payment/fail`)

## üîë –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞:

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:

**–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:**
- –ù–æ–º–µ—Ä: `5555 5555 5555 4444`
- –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞
- CVV: –ª—é–±–æ–π 3-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- –ò–º—è: TEST CARDHOLDER

**–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞:**
- –ù–æ–º–µ—Ä: `5555 5555 5555 5557`

## üìã –ü–æ—Ç–æ–∫ –æ–ø–ª–∞—Ç—ã:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å"
                 ‚Üì
2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí POST /api/payment/create
                 ‚Üì
3. –ë—ç–∫–µ–Ω–¥ ‚Üí –°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–µ
                 ‚Üì
4. –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç formUrl
                 ‚Üì
5. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ formUrl
                 ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
                 ‚Üì
7. –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ ‚Üí –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂
                 ‚Üì
8. –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ returnUrl (–≤–∞—à —Å–∞–π—Ç)
                 ‚Üì
9. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí GET /api/payment/status/:id
                 ‚Üì
10. –ë—ç–∫–µ–Ω–¥ ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–µ
                 ‚Üì
11. –ë—ç–∫–µ–Ω–¥ ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç isPremium –µ—Å–ª–∏ succeeded
                 ‚Üì
12. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–£—Å–ø–µ—à–Ω–æ!" –∏–ª–∏ "–û—à–∏–±–∫–∞"
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:

1. **–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - `/payment/success` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
   - `/payment/fail` - –æ—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã

2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∏–∑ `docs/frontend/payment-integration-example.tsx`
   - –ü—Ä–∏ –∫–ª–∏–∫–µ –≤—ã–∑—ã–≤–∞—Ç—å `POST /api/payment/create`
   - –ü–æ–ª—É—á–∞—Ç—å `paymentUrl` –∏ –¥–µ–ª–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç

3. **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç:**
   - –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/payment/success` –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –î–ª—è –ø—Ä–æ–¥–∞ (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):

–ö–æ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ, –∑–∞–º–µ–Ω–∏—Ç–µ –≤ `.env`:

```env
# Production
ALFABANK_API_URL=https://payment.alfabank.ru/payment/rest
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- [PAYMENT-TESTING.md](PAYMENT-TESTING.md) - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- [payment-integration-example.tsx](docs/frontend/payment-integration-example.tsx) - –ø—Ä–∏–º–µ—Ä—ã React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://pay.alfabank.ru/ecommerce/instructions/merchantManual/pages/index/rest.html

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:

- [x] –ú–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã (Payment, –æ–±–Ω–æ–≤–ª–µ–Ω User)
- [x] –°–µ—Ä–≤–∏—Å –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] API —Ä–æ—É—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- [x] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –ö–æ–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
- [x] –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [x] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production API

## üîç –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
ssh root@37.252.20.170 "pm2 logs rejuvena-backend"
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
ssh root@37.252.20.170 "pm2 status"
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**API:** https://api-rejuvena.duckdns.org  
**–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞:** https://web.rbsuat.com/ab  
