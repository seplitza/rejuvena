"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{1807:function(e,r,t){t.d(r,{Z:function(){return s}});var n=t(5893),i=t(7294),o=t(5871);function s(e){let{isOpen:r,onClose:t,productType:s,productId:a,productName:d,price:l,onPaymentSuccess:c}=e,[p,u]=(0,i.useState)(!1),[x,h]=(0,i.useState)(null);(0,i.useEffect)(()=>{r||(h(null),u(!1))},[r]);let f=async()=>{try{var e;u(!0),h(null);let r=localStorage.getItem("auth_token");if(!r)throw Error("Требуется авторизация");let t="",n={};"premium"===s?(t="".concat(o.T5,"/api/payment/create"),n={amount:l,description:"Премиум подписка",planType:"premium",duration:30}):"exercise"===s?(t="".concat(o.T5,"/api/payment/create-exercise"),n={exerciseId:a,exerciseName:d,price:l}):"marathon"===s&&(t="".concat(o.T5,"/api/payment/create-marathon"),n={marathonId:a,marathonName:d,price:l});let i=await fetch(t,{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){let e=await i.json();throw Error(e.error||"Ошибка при создании платежа")}let c=await i.json();if(!(null===(e=c.payment)||void 0===e?void 0:e.paymentUrl))throw Error("Не получена ссылка для оплаты");window.location.href=c.payment.paymentUrl}catch(e){console.error("Payment error:",e),h(e instanceof Error?e.message:"Произошла ошибка при оплате")}finally{u(!1)}};return r?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{onClick:t,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9998,padding:"20px"},children:(0,n.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{background:"white",borderRadius:"16px",maxWidth:"500px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",zIndex:9999},children:[(0,n.jsxs)("div",{style:{padding:"24px",borderBottom:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsxs)("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#111827",margin:0},children:[(()=>{switch(s){case"premium":return"⭐";case"exercise":return"\uD83D\uDCAA";case"marathon":return"\uD83C\uDFC3";default:return"\uD83D\uDCB3"}})()," Оплата"]}),(0,n.jsx)("button",{onClick:t,disabled:p,style:{background:"transparent",border:"none",fontSize:"24px",cursor:p?"not-allowed":"pointer",color:"#6B7280",padding:"4px"},children:"\xd7"})]}),(0,n.jsxs)("div",{style:{padding:"24px"},children:[(0,n.jsxs)("div",{style:{background:"#F9FAFB",padding:"20px",borderRadius:"12px",marginBottom:"24px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#6B7280",marginBottom:"8px"},children:(()=>{switch(s){case"premium":return"Премиум подписка";case"exercise":return"Упражнение";case"marathon":return"Марафон";default:return"Покупка"}})()}),(0,n.jsx)("div",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",marginBottom:"16px"},children:d}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"16px",borderTop:"1px solid #E5E7EB"},children:[(0,n.jsx)("div",{style:{fontSize:"16px",color:"#6B7280"},children:"Итого к оплате:"}),(0,n.jsxs)("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#4F46E5"},children:[l," ₽"]})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"12px"},children:"Способ оплаты"}),(0,n.jsxs)("div",{style:{padding:"16px",border:"2px solid #4F46E5",borderRadius:"8px",display:"flex",alignItems:"center",gap:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"24px"},children:"\uD83D\uDCB3"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"15px",fontWeight:"600",color:"#111827"},children:"Альфа-банк"}),(0,n.jsx)("div",{style:{fontSize:"13px",color:"#6B7280"},children:"Банковская карта (Visa, MasterCard, МИР)"})]})]})]}),x&&(0,n.jsxs)("div",{style:{padding:"12px 16px",background:"#FEE2E2",border:"1px solid #FCA5A5",borderRadius:"8px",color:"#DC2626",fontSize:"14px",marginBottom:"20px"},children:["❌ ",x]}),(0,n.jsx)("div",{style:{padding:"16px",background:"#EEF2FF",borderRadius:"8px",marginBottom:"24px"},children:(0,n.jsxs)("div",{style:{fontSize:"13px",color:"#4F46E5",lineHeight:"1.6"},children:['ℹ️ После нажатия кнопки "Оплатить" вы будете перенаправлены на защищённую страницу оплаты Альфа-банка.',"marathon"===s&&" После успешной оплаты вы будете автоматически записаны на марафон.","exercise"===s&&" После успешной оплаты упражнение станет доступным в течение 30 дней.","premium"===s&&" После успешной оплаты премиум-доступ будет активирован на 30 дней."]})}),(0,n.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,n.jsx)("button",{onClick:t,disabled:p,style:{flex:1,padding:"14px",background:"#F3F4F6",color:"#374151",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:p?"not-allowed":"pointer",opacity:p?.5:1},children:"Отмена"}),(0,n.jsx)("button",{onClick:f,disabled:p,style:{flex:2,padding:"14px",background:p?"#9CA3AF":"#4F46E5",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:p?"not-allowed":"pointer",transition:"background 0.2s"},children:p?"Загрузка...":"Оплатить ".concat(l," ₽")})]})]})]})})}):null}},4100:function(e,r,t){function n(e){let r=e.map(e=>e.toLowerCase());if(r.includes("бесплатное")||r.includes("на здоровье"))return{isFree:!0,isPremium:!1,price:0,priceType:"free"};let t=r.includes("продвинутое")||r.includes("pro");return r.includes("базовое")||r.includes("платное базовое"),t?{isFree:!1,isPremium:!0,price:200,priceType:"pro"}:{isFree:!1,isPremium:!0,price:100,priceType:"basic"}}function i(e,r){if(r)return!0;try{let r=localStorage.getItem("purchased_exercises");if(!r)return!1;return JSON.parse(r).includes(e)}catch(e){return!1}}function o(e){if(e.isFree)return"На здоровье";switch(e.priceType){case"pro":return"PRO";case"basic":return"Базовое";default:return null}}t.d(r,{Sw:function(){return n},ns:function(){return o},qI:function(){return i}})}}]);