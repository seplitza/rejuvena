(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{9408:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/exercise/[exerciseId]",function(){return l(1541)}])},1541:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return d}});var r=l(5893),s=l(7294),i=l(1163),n=l(1807),o=l(4100),a=l(3586),c=l(5871);function d(){var e,t;let l=(0,i.useRouter)(),{exerciseId:d}=l.query,u=(0,s.useRef)(null),[m,p]=(0,s.useState)(null),[x,h]=(0,s.useState)(!0),[b,f]=(0,s.useState)(!1),[v,g]=(0,s.useState)(!1),[w,j]=(0,s.useState)(0),[y,N]=(0,s.useState)([]),[k,C]=(0,s.useState)(!1),[E,_]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{d&&(async()=>{try{h(!0);let e=await fetch("".concat(c.T5,"/api/exercises/public")),t=(await e.json()).find(e=>e._id===d);if(t){p(t);let e=(0,o.Sw)(t.tags.map(e=>e.name)),l=(0,o.qI)(t._id);_(e.isFree||l),e.isFree||l||C(!0)}else l.push("/404")}catch(e){console.error("Failed to load exercise:",e)}finally{h(!1)}})()},[d,l]),(0,s.useEffect)(()=>{m&&(N(m.carouselMedia.filter(e=>"video"===e.type||"image"===e.type).sort((e,t)=>e.order-t.order).map(e=>{let t={id:e.url,type:e.type,contentPath:e.url,loadError:!1};if("video"===e.type){let{embedUrl:l,type:r}=function(e){var t,l,r,s;if(!e)return{embedUrl:"",type:"iframe"};if(e.match(/\.(mp4|webm|ogg|mov)$/i))return{embedUrl:e,type:"video"};if(e.includes("youtube.com")||e.includes("youtu.be")){if(e.includes("/embed/"))return{embedUrl:e,type:"iframe"};let l=e.includes("youtu.be")?null===(t=e.split("youtu.be/")[1])||void 0===t?void 0:t.split("?")[0]:new URL(e).searchParams.get("v");return{embedUrl:"https://www.youtube.com/embed/".concat(l),type:"iframe"}}if(e.includes("vimeo.com")){if(e.includes("player.vimeo.com/video/"))return{embedUrl:e,type:"iframe"};let t=null===(l=e.split("vimeo.com/")[1])||void 0===l?void 0:l.split("?")[0];return{embedUrl:"https://player.vimeo.com/video/".concat(t),type:"iframe"}}if(e.includes("rutube.ru")){let t=(null===(r=e.split("/video/")[1])||void 0===r?void 0:r.split("/")[0])||(null===(s=e.split("/play/embed/")[1])||void 0===s?void 0:s.split("?")[0]);return{embedUrl:"https://rutube.ru/play/embed/".concat(t),type:"iframe"}}if(e.includes("vk.com/video")){let t=e.match(/video(-?\d+)_(\d+)/);if(t)return{embedUrl:"https://vk.com/video_ext.php?oid=".concat(t[1],"&id=").concat(t[2]),type:"iframe"}}return e.includes("dzen.ru"),{embedUrl:e,type:"iframe"}}(e.url);t.embedUrl=l,t.videoType=r}return t})),j(0))},[m]),(0,s.useEffect)(()=>{let e=()=>{g(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]),x)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})});if(!m)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDE1E"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Упражнение не найдено"}),(0,r.jsx)("button",{onClick:()=>l.push("/exercises"),className:"mt-4 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Вернуться к списку"})]})});let L=(0,o.Sw)(m.tags.map(e=>e.name)),U=!E;return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50",children:[(0,r.jsx)("header",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg sticky top-0 z-10",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-3 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("button",{onClick:()=>l.back(),className:"p-2 hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Назад",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,r.jsx)("h1",{className:"text-xl font-bold",children:m.title}),!L.isFree&&(0,r.jsx)("span",{className:"inline-block mt-1 bg-white/20 text-xs px-2 py-1 rounded-full",children:"pro"===L.priceType?"PRO":"PREMIUM"})]}),(0,r.jsx)("button",{onClick:()=>{f(!b)},disabled:!E,className:"flex-shrink-0 p-2 rounded-lg transition-all ".concat(b?"bg-green-500 text-white":"bg-white/10 hover:bg-white/20"," ").concat(E?"":"opacity-50 cursor-not-allowed"),"aria-label":b?"Отметить как невыполненное":"Отметить как выполненное",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:b?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})})}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto py-6 relative",children:[U&&!k&&(0,r.jsx)("div",{className:"absolute inset-0 z-20 backdrop-blur-md bg-white/30 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD12"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Премиум упражнение"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-4",children:["Это упражнение доступно по подписке ","pro"===L.priceType?"PRO":"PREMIUM"]}),(0,r.jsxs)("button",{onClick:()=>C(!0),className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all",children:["Разблокировать за ",L.price," ₽"]})]})}),y.length>0&&(0,r.jsx)("div",{className:"bg-white shadow-lg mb-6 py-6 ".concat(U?"filter blur-sm":""),children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-full ".concat((null===(e=y[w])||void 0===e?void 0:e.type)==="image"?"max-w-[200px]":"max-w-[400px]"),children:(0,r.jsxs)("div",{className:"relative w-full",ref:u,children:[y[w]&&(0,r.jsx)("div",{className:"w-full",children:"video"===y[w].type?"video"===y[w].videoType?(0,r.jsx)("video",{src:y[w].embedUrl,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",disablePictureInPicture:!0,className:"w-full aspect-square object-contain bg-white rounded-lg",playsInline:!0,onContextMenu:e=>e.preventDefault()}):(0,r.jsxs)("div",{className:"relative w-full aspect-square bg-black rounded-lg overflow-hidden",children:[(0,r.jsx)("iframe",{src:y[w].embedUrl,className:"w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),!v&&(0,r.jsx)("button",{onClick:()=>{u.current&&(document.fullscreenElement?(document.exitFullscreen(),g(!1)):(u.current.requestFullscreen().catch(e=>{console.error("Error entering fullscreen:",e)}),g(!0)))},className:"absolute bottom-4 right-4 bg-black/50 hover:bg-black/70 text-white p-2 rounded-lg transition-colors","aria-label":"Полноэкранный режим",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}):(0,r.jsx)("img",{src:y[w].contentPath,alt:"Exercise",className:"w-full aspect-square object-contain bg-white rounded-lg"})},y[w].id),y.length>1&&(0,r.jsxs)(r.Fragment,{children:[w>0&&(0,r.jsx)("button",{onClick:()=>j(w-1),className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-2 rounded-full shadow-lg transition-colors",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),w<y.length-1&&(0,r.jsx)("button",{onClick:()=>j(w+1),className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-2 rounded-full shadow-lg transition-colors",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,r.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:y.map((e,t)=>(0,r.jsx)("button",{onClick:()=>j(t),className:"w-2 h-2 rounded-full transition-colors ".concat(t===w?"bg-purple-600":"bg-gray-300")},t))})]})]})}),(null===(t=y[w])||void 0===t?void 0:t.type)==="image"&&y.length>1&&(0,r.jsx)("div",{className:"mt-4 w-full max-w-[400px]",children:(0,r.jsxs)("div",{className:"bg-purple-600/95 text-white text-sm px-4 py-3 rounded-lg text-center shadow-lg",children:[(0,r.jsx)("p",{className:"font-semibold mb-1",children:"\uD83D\uDCA1 Основное движение"}),(0,r.jsx)("p",{className:"text-xs opacity-90",children:"Ознакомьтесь с видео инструкцией, нажмите на стрелочку вправо"})]})})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6 mx-4 ".concat(U?"filter blur-sm":""),children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Описание"}),(0,r.jsx)("div",{className:"prose prose-purple max-w-none",dangerouslySetInnerHTML:{__html:m.content||m.description}}),m.duration&&(0,r.jsxs)("div",{className:"mt-4 text-gray-600",children:[(0,r.jsx)("strong",{children:"Длительность:"})," ",m.duration]})]}),d&&"string"==typeof d&&(0,r.jsx)("div",{className:"mx-4 ".concat(U?"filter blur-sm":""),children:(0,r.jsx)(a.Z,{exerciseId:d,context:"exercise"})})]}),(0,r.jsx)(n.Z,{productType:"exercise",productId:m._id,isOpen:k,onClose:()=>C(!1),price:L.price,productName:m.title})]})}}},function(e){e.O(0,[586,597,888,774,179],function(){return e(e.s=9408)}),_N_E=e.O()}]);