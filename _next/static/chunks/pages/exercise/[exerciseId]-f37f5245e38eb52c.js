(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{9408:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/exercise/[exerciseId]",function(){return r(1541)}])},1541:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var l=r(5893),s=r(7294),i=r(1163),a=r(1807),n=r(4100),o=r(5871);function c(){var e,t;let r=(0,i.useRouter)(),{exerciseId:c}=r.query,d=(0,s.useRef)(null),[u,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(!0),[h,b]=(0,s.useState)(!1),[f,g]=(0,s.useState)(!1),[v,w]=(0,s.useState)([]),[j,y]=(0,s.useState)(""),[N,k]=(0,s.useState)(0),[C,E]=(0,s.useState)([]),[_,L]=(0,s.useState)(!1),[U,S]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{c&&(async()=>{try{x(!0);let e=await fetch("".concat(o.T,"/api/exercises/public")),t=(await e.json()).find(e=>e._id===c);if(t){m(t);let e=(0,n.Sw)(t.tags.map(e=>e.name)),r=(0,n.qI)(t._id);S(e.isFree||r),e.isFree||r||L(!0)}else r.push("/404")}catch(e){console.error("Failed to load exercise:",e)}finally{x(!1)}})()},[c,r]),(0,s.useEffect)(()=>{u&&(E(u.carouselMedia.filter(e=>"video"===e.type||"image"===e.type).sort((e,t)=>e.order-t.order).map(e=>{let t={id:e.url,type:e.type,contentPath:e.url,loadError:!1};if("video"===e.type){let{embedUrl:r,type:l}=function(e){var t,r,l,s;if(!e)return{embedUrl:"",type:"iframe"};if(e.match(/\.(mp4|webm|ogg|mov)$/i))return{embedUrl:e,type:"video"};if(e.includes("youtube.com")||e.includes("youtu.be")){if(e.includes("/embed/"))return{embedUrl:e,type:"iframe"};let r=e.includes("youtu.be")?null===(t=e.split("youtu.be/")[1])||void 0===t?void 0:t.split("?")[0]:new URL(e).searchParams.get("v");return{embedUrl:"https://www.youtube.com/embed/".concat(r),type:"iframe"}}if(e.includes("vimeo.com")){if(e.includes("player.vimeo.com/video/"))return{embedUrl:e,type:"iframe"};let t=null===(r=e.split("vimeo.com/")[1])||void 0===r?void 0:r.split("?")[0];return{embedUrl:"https://player.vimeo.com/video/".concat(t),type:"iframe"}}if(e.includes("rutube.ru")){let t=(null===(l=e.split("/video/")[1])||void 0===l?void 0:l.split("/")[0])||(null===(s=e.split("/play/embed/")[1])||void 0===s?void 0:s.split("?")[0]);return{embedUrl:"https://rutube.ru/play/embed/".concat(t),type:"iframe"}}if(e.includes("vk.com/video")){let t=e.match(/video(-?\d+)_(\d+)/);if(t)return{embedUrl:"https://vk.com/video_ext.php?oid=".concat(t[1],"&id=").concat(t[2]),type:"iframe"}}return e.includes("dzen.ru"),{embedUrl:e,type:"iframe"}}(e.url);t.embedUrl=r,t.videoType=l}return t})),k(0))},[u]),(0,s.useEffect)(()=>{u&&w([{id:"1",userName:"Ирина М.",userAvatar:"https://ui-avatars.com/api/?name=Irina+M&background=ec4899&color=fff",text:"Делаю это упражнение каждое утро. Главное не торопиться и делать все плавно.",date:"27 декабря 2025"}])},[u]),(0,s.useEffect)(()=>{let e=()=>{g(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]),p)return(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})});if(!u)return(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDE1E"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Упражнение не найдено"}),(0,l.jsx)("button",{onClick:()=>r.push("/exercises"),className:"mt-4 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Вернуться к списку"})]})});let M=(0,n.Sw)(u.tags.map(e=>e.name)),D=!U;return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50",children:[(0,l.jsx)("header",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg sticky top-0 z-10",children:(0,l.jsx)("div",{className:"max-w-4xl mx-auto px-3 py-3",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("button",{onClick:()=>r.back(),className:"p-2 hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Назад",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,l.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,l.jsx)("h1",{className:"text-xl font-bold",children:u.title}),!M.isFree&&(0,l.jsx)("span",{className:"inline-block mt-1 bg-white/20 text-xs px-2 py-1 rounded-full",children:"pro"===M.priceType?"PRO":"PREMIUM"})]}),(0,l.jsx)("button",{onClick:()=>{b(!h)},disabled:!U,className:"flex-shrink-0 p-2 rounded-lg transition-all ".concat(h?"bg-green-500 text-white":"bg-white/10 hover:bg-white/20"," ").concat(U?"":"opacity-50 cursor-not-allowed"),"aria-label":h?"Отметить как невыполненное":"Отметить как выполненное",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:h?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})})}),(0,l.jsxs)("div",{className:"max-w-4xl mx-auto py-6 relative",children:[D&&!_&&(0,l.jsx)("div",{className:"absolute inset-0 z-20 backdrop-blur-md bg-white/30 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 text-center",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD12"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Премиум упражнение"}),(0,l.jsxs)("p",{className:"text-gray-600 mb-4",children:["Это упражнение доступно по подписке ","pro"===M.priceType?"PRO":"PREMIUM"]}),(0,l.jsxs)("button",{onClick:()=>L(!0),className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all",children:["Разблокировать за ",M.price," ₽"]})]})}),C.length>0&&(0,l.jsx)("div",{className:"bg-white shadow-lg mb-6 py-6 ".concat(D?"filter blur-sm":""),children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("div",{className:"w-full ".concat((null===(e=C[N])||void 0===e?void 0:e.type)==="image"?"max-w-[200px]":"max-w-[400px]"),children:(0,l.jsxs)("div",{className:"relative w-full",ref:d,children:[C[N]&&(0,l.jsx)("div",{className:"w-full",children:"video"===C[N].type?"video"===C[N].videoType?(0,l.jsx)("video",{src:C[N].embedUrl,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",disablePictureInPicture:!0,className:"w-full aspect-square object-contain bg-white rounded-lg",playsInline:!0,onContextMenu:e=>e.preventDefault()}):(0,l.jsxs)("div",{className:"relative w-full aspect-square bg-black rounded-lg overflow-hidden",children:[(0,l.jsx)("iframe",{src:C[N].embedUrl,className:"w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),!f&&(0,l.jsx)("button",{onClick:()=>{d.current&&(document.fullscreenElement?(document.exitFullscreen(),g(!1)):(d.current.requestFullscreen().catch(e=>{console.error("Error entering fullscreen:",e)}),g(!0)))},className:"absolute bottom-4 right-4 bg-black/50 hover:bg-black/70 text-white p-2 rounded-lg transition-colors","aria-label":"Полноэкранный режим",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}):(0,l.jsx)("img",{src:C[N].contentPath,alt:"Exercise",className:"w-full aspect-square object-contain bg-white rounded-lg"})},C[N].id),C.length>1&&(0,l.jsxs)(l.Fragment,{children:[N>0&&(0,l.jsx)("button",{onClick:()=>k(N-1),className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-2 rounded-full shadow-lg transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),N<C.length-1&&(0,l.jsx)("button",{onClick:()=>k(N+1),className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white p-2 rounded-full shadow-lg transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,l.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:C.map((e,t)=>(0,l.jsx)("button",{onClick:()=>k(t),className:"w-2 h-2 rounded-full transition-colors ".concat(t===N?"bg-purple-600":"bg-gray-300")},t))})]})]})}),(null===(t=C[N])||void 0===t?void 0:t.type)==="image"&&C.length>1&&(0,l.jsx)("div",{className:"mt-4 w-full max-w-[400px]",children:(0,l.jsxs)("div",{className:"bg-purple-600/95 text-white text-sm px-4 py-3 rounded-lg text-center shadow-lg",children:[(0,l.jsx)("p",{className:"font-semibold mb-1",children:"\uD83D\uDCA1 Основное движение"}),(0,l.jsx)("p",{className:"text-xs opacity-90",children:"Ознакомьтесь с видео инструкцией, нажмите на стрелочку вправо"})]})})]})}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6 mx-4 ".concat(D?"filter blur-sm":""),children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Описание"}),(0,l.jsx)("div",{className:"prose prose-purple max-w-none",dangerouslySetInnerHTML:{__html:u.content||u.description}}),u.duration&&(0,l.jsxs)("div",{className:"mt-4 text-gray-600",children:[(0,l.jsx)("strong",{children:"Длительность:"})," ",u.duration]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mx-4 ".concat(D?"filter blur-sm":""),children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["Комментарии (",v.length,")"]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("textarea",{value:j,onChange:e=>y(e.target.value),placeholder:"Напишите комментарий...",disabled:!U,className:"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none disabled:opacity-50 disabled:cursor-not-allowed",rows:3}),(0,l.jsx)("button",{onClick:()=>{j.trim()&&(w([{id:Date.now().toString(),userName:"Вы",userAvatar:"https://ui-avatars.com/api/?name=User&background=8b5cf6&color=fff",text:j,date:new Date().toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})},...v]),y(""))},disabled:!j.trim()||!U,className:"mt-2 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Отправить"})]}),(0,l.jsx)("div",{className:"space-y-4",children:0===v.length?(0,l.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Комментариев пока нет. Будьте первым!"}):v.map(e=>(0,l.jsxs)("div",{className:"flex space-x-4 p-4 bg-gray-50 rounded-lg",children:[(0,l.jsx)("img",{src:e.userAvatar,alt:e.userName,className:"w-12 h-12 rounded-full flex-shrink-0"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,l.jsx)("h3",{className:"font-semibold text-gray-900",children:e.userName}),(0,l.jsx)("span",{className:"text-sm text-gray-500",children:e.date})]}),(0,l.jsx)("p",{className:"text-gray-700",children:e.text})]})]},e.id))})]})]}),(0,l.jsx)(a.Z,{productType:"exercise",productId:u._id,isOpen:_,onClose:()=>L(!1),price:M.price,productName:u.title})]})}}},function(e){e.O(0,[597,888,774,179],function(){return e(e.s=9408)}),_N_E=e.O()}]);