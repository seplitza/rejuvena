(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[311],{4983:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/courses/[courseId]/day/[dayId]/exercise/[exerciseId]",function(){return r(450)}])},450:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var n=r(5893),i=r(7294),l=r(1163),s=r(9133),a=r(5689),o=r(7369),c=r(803),u=r(5675),d=r.n(u);function m(){let e=(0,l.useRouter)(),{courseId:t,dayId:r,exerciseId:u}=e.query,m=(0,s.T)(),p=(0,s.C)(a.MK),f=(0,s.C)(a.hV),h=(0,s.C)(a.b0),[x,v]=(0,i.useState)(!1),[b,y]=(0,i.useState)(""),[g,j]=(0,i.useState)([]),[w,N]=(0,i.useState)(!0),[k,C]=(0,i.useState)(!1),E=(0,i.useRef)(null),I=null,_="";if(p&&u)for(let e of p){let t=e.exercises.findIndex(e=>e.id===u);if(-1!==t){I=e.exercises[t],_="".concat(t,"-").concat(e.id,"-").concat(I.id);break}}let D=!!I&&!!_&&(void 0!==h[_]?h[_]:I.isDone),L=!!I&&!!_&&f[_];(0,i.useEffect)(()=>{u&&t&&(async()=>{try{N(!0);let e=await c.WY.get(c.Hv.eI,{params:{exerciseId:u,marathonId:t,pageNumber:1,pageSize:50}});j(e.items||[])}catch(e){console.error("Failed to load comments:",e),j([])}finally{N(!1)}})()},[u,t]),(0,i.useEffect)(()=>{let e=()=>{v(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]);let S=async()=>{if(E.current)try{x?await document.exitFullscreen():await E.current.requestFullscreen()}catch(e){console.error("Fullscreen error:",e)}},z=async()=>{I&&_&&!L&&m((0,o.R$)({marathonExerciseId:I.marathonExerciseId,status:!D,dayId:r,uniqueId:_}))},P=async e=>{if(e.preventDefault(),b.trim()&&!k&&u)try{C(!0),await c.WY.post(c.Hv.W1,{exerciseId:u,comment:b.trim()});let e=await c.WY.get(c.Hv.eI,{params:{exerciseId:u,marathonId:t,pageNumber:1,pageSize:50}});j(e.items||[]),y("")}catch(e){console.error("Failed to post comment:",e),alert("Не удалось отправить комментарий. Попробуйте еще раз.")}finally{C(!1)}};if(!I)return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-pink-50 to-purple-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Упражнение не найдено"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Вернитесь на страницу дня"}),(0,n.jsx)("button",{onClick:()=>e.back(),className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Назад"})]})});let{embedUrl:U,type:R}=function(e){var t,r,n,i,l,s;if(!e)return{embedUrl:"",type:"iframe"};if(e.match(/\.(mp4|webm|ogg|mov)$/i))return{embedUrl:e,type:"video"};if(e.includes("youtube.com")||e.includes("youtu.be")){let r=e.includes("youtu.be")?null===(t=e.split("youtu.be/")[1])||void 0===t?void 0:t.split("?")[0]:new URL(e).searchParams.get("v");return{embedUrl:"https://www.youtube.com/embed/".concat(r),type:"iframe"}}if(e.includes("vimeo.com")){let t=null===(r=e.split("vimeo.com/")[1])||void 0===r?void 0:r.split("?")[0];return{embedUrl:"https://player.vimeo.com/video/".concat(t),type:"iframe"}}if(e.includes("rutube.ru")){let t=null===(n=e.split("rutube.ru/video/")[1])||void 0===n?void 0:n.split("?")[0];return t||(t=null===(i=e.split("rutube.ru/play/embed/")[1])||void 0===i?void 0:i.split("?")[0]),{embedUrl:"https://rutube.ru/play/embed/".concat(t),type:"iframe"}}if(e.includes("vk.com/video")){let t=e.match(/video(-?\d+)_(\d+)/);if(t){let[,e,r]=t;return{embedUrl:"https://vk.com/video_ext.php?oid=".concat(e,"&id=").concat(r),type:"iframe"}}}if(e.includes("dzen.ru")){let t=(null===(l=e.split("dzen.ru/video/watch/")[1])||void 0===l?void 0:l.split("?")[0])||(null===(s=e.split("dzen.ru/embed/")[1])||void 0===s?void 0:s.split("?")[0]);if(t)return{embedUrl:"https://dzen.ru/embed/".concat(t),type:"iframe"}}return e.includes("t.me"),{embedUrl:e,type:"iframe"}}(I.videoUrl||"");return(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50",children:[(0,n.jsx)("header",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg sticky top-0 z-50",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("button",{onClick:()=>e.back(),className:"p-2 hover:bg-white/10 rounded-lg transition-colors flex-shrink-0","aria-label":"Назад",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("h1",{className:"text-lg font-bold truncate",children:[(0,n.jsx)("span",{className:"font-bold",children:I.exerciseName})," ",I.marathonExerciseName]}),(0,n.jsxs)("p",{className:"text-sm text-white/80",children:[Math.floor(I.duration/60)," мин"]})]}),(0,n.jsx)("button",{onClick:z,disabled:L||I.blockExercise,className:"flex-shrink-0 w-10 h-10 rounded-lg border-2 flex items-center justify-center transition-all ".concat(I.blockExercise?"border-white/30 cursor-not-allowed opacity-50":D?"bg-white border-white":"border-white/50 hover:border-white hover:bg-white/10"),"aria-label":D?"Отменить выполнение":"Отметить как выполненное",children:L?(0,n.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-purple-600"}):D?(0,n.jsx)("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):null})]})})}),(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6 space-y-6",children:[I.videoUrl&&(0,n.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-4",children:(0,n.jsxs)("div",{ref:E,className:"relative w-full max-w-[400px] mx-auto ".concat(x?"max-w-full":""),style:{paddingBottom:x?"56.25%":"min(100%, 400px)"},children:["video"===R?(0,n.jsx)("video",{className:"absolute top-0 left-0 w-full h-full rounded-lg object-cover",src:U,controls:!0,playsInline:!0,title:"".concat(I.exerciseName," ").concat(I.marathonExerciseName)}):(0,n.jsx)("iframe",{className:"absolute top-0 left-0 w-full h-full rounded-lg",src:U,title:"".concat(I.exerciseName," ").concat(I.marathonExerciseName),frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),(0,n.jsx)("button",{onClick:S,className:"absolute bottom-4 right-4 bg-black/60 hover:bg-black/80 text-white p-2 rounded-lg transition-all z-10","aria-label":x?"Выйти из полноэкранного режима":"На весь экран",children:x?(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})}),I.description&&(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"bg-gradient-to-r from-purple-100 to-pink-100 px-6 py-4",children:(0,n.jsx)("h2",{className:"text-xl font-bold text-purple-900",children:"Описание упражнения"})}),(0,n.jsx)("div",{className:"px-6 py-6",children:(0,n.jsx)("div",{className:"prose prose-purple max-w-none",dangerouslySetInnerHTML:{__html:I.description}})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"bg-gradient-to-r from-purple-100 to-pink-100 px-6 py-4",children:(0,n.jsxs)("h2",{className:"text-xl font-bold text-purple-900",children:["Комментарии ",!w&&"(".concat(g.length,")")]})}),(0,n.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,n.jsxs)("form",{onSubmit:P,children:[(0,n.jsx)("textarea",{value:b,onChange:e=>y(e.target.value),placeholder:"Поделитесь своими впечатлениями об упражнении...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent resize-none",rows:3,disabled:k}),(0,n.jsx)("div",{className:"mt-3 flex justify-end",children:(0,n.jsx)("button",{type:"submit",disabled:!b.trim()||k,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:k?"Отправка...":"Отправить"})})]})}),(0,n.jsx)("div",{className:"divide-y divide-gray-200",children:w?(0,n.jsxs)("div",{className:"px-6 py-8 text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),(0,n.jsx)("p",{className:"text-gray-500 mt-2",children:"Загрузка комментариев..."})]}):0===g.length?(0,n.jsx)("div",{className:"px-6 py-8 text-center text-gray-500",children:"Комментариев пока нет. Будьте первым!"}):g.map(e=>(0,n.jsx)("div",{className:"px-6 py-4",children:(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)("div",{className:"relative w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-purple-100",children:e.userImage?(0,n.jsx)(d(),{src:e.userImage,alt:e.userName,fill:!0,className:"object-cover"}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center text-purple-600 font-bold",children:e.userName.charAt(0).toUpperCase()})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{className:"font-semibold text-gray-900",children:e.userName}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.commentDate).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})})]}),(0,n.jsx)("p",{className:"mt-1 text-gray-700",children:e.comment}),(0,n.jsxs)("div",{className:"mt-2 flex items-center space-x-4 text-sm text-gray-500",children:[e.likeCount>0&&(0,n.jsxs)("span",{children:["❤️ ",e.likeCount]}),e.childCommentCount>0&&(0,n.jsxs)("span",{children:["\uD83D\uDCAC ",e.childCommentCount]})]})]})]})},e.id))})]})]})]})}},5689:function(e,t,r){"use strict";r.d(t,{LV:function(){return s},MK:function(){return c},Rc:function(){return a},_R:function(){return l},ay:function(){return o},b0:function(){return d},cx:function(){return p},h6:function(){return f},hV:function(){return u},z6:function(){return m}});var n=r(8697);let i=e=>e.dayReducer,l=(0,n.P1)(i,e=>e.currentDay),s=(0,n.P1)(i,e=>e.loading),a=(0,n.P1)(i,e=>e.error),o=(0,n.P1)(l,e=>(null==e?void 0:e.marathonDay)||null),c=(0,n.P1)(o,e=>(null==e?void 0:e.dayCategories)||[]),u=(0,n.P1)(i,e=>e.changingStatusRequests),d=(0,n.P1)(i,e=>e.updatedExercisesStatus),m=(0,n.P1)(i,e=>e.activeExerciseId),p=(0,n.P1)(l,e=>(null==e?void 0:e.title)||""),f=(0,n.P1)(i,e=>e.marathonData)},8697:function(e,t,r){"use strict";r.d(t,{P1:function(){return l}});var n="NOT_FOUND",i=function(e,t){return e===t},l=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(){for(var t,n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];var s=0,a={memoizeOptions:void 0},o=i.pop();if("object"==typeof o&&(a=o,o=i.pop()),"function"!=typeof o)throw Error("createSelector expects an output function after the inputs, but received: ["+typeof o+"]");var c=a.memoizeOptions,u=void 0===c?r:c,d=Array.isArray(u)?u:[u],m=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(e){return"function"==typeof e}))throw Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t.map(function(e){return"function"==typeof e?"function "+(e.name||"unnamed")+"()":typeof e}).join(", ")+"]");return t}(i),p=e.apply(void 0,[function(){return s++,o.apply(null,arguments)}].concat(d)),f=e(function(){for(var e=[],r=m.length,n=0;n<r;n++)e.push(m[n].apply(null,arguments));return t=p.apply(null,e)});return Object.assign(f,{resultFunc:o,memoizedResultFunc:p,dependencies:m,lastResult:function(){return t},recomputations:function(){return s},resetRecomputations:function(){return s=0}}),f}}(function(e,t){var r,l,s="object"==typeof t?t:{equalityCheck:t},a=s.equalityCheck,o=s.maxSize,c=void 0===o?1:o,u=s.resultEqualityCheck,d=(r=void 0===a?i:a,function(e,t){if(null===e||null===t||e.length!==t.length)return!1;for(var n=e.length,i=0;i<n;i++)if(!r(e[i],t[i]))return!1;return!0}),m=1===c?{get:function(e){return l&&d(l.key,e)?l.value:n},put:function(e,t){l={key:e,value:t}},getEntries:function(){return l?[l]:[]},clear:function(){l=void 0}}:function(e,t){var r=[];function i(e){var i=r.findIndex(function(r){return t(e,r.key)});if(i>-1){var l=r[i];return i>0&&(r.splice(i,1),r.unshift(l)),l.value}return n}return{get:i,put:function(t,l){i(t)===n&&(r.unshift({key:t,value:l}),r.length>e&&r.pop())},getEntries:function(){return r},clear:function(){r=[]}}}(c,d);function p(){var t=m.get(arguments);if(t===n){if(t=e.apply(null,arguments),u){var r=m.getEntries().find(function(e){return u(e.value,t)});r&&(t=r.value)}m.put(arguments,t)}return t}return p.clearCache=function(){return m.clear()},p})}},function(e){e.O(0,[675,888,774,179],function(){return e(e.s=4983)}),_N_E=e.O()}]);