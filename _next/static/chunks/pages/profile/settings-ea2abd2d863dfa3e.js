(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{7858:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile/settings",function(){return r(1958)}])},1958:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(5893),a=r(7294),l=r(1163),o=r(9008),n=r.n(o),d=r(1664),i=r.n(d),c=r(9133),u=r(3031),m=r(1624),x=r(8256);function h(){let e=(0,l.useRouter)(),t=(0,c.T)(),{isAuthenticated:r,user:o}=(0,c.C)(e=>e.auth),[d,h]=(0,a.useState)("ru"),[p,g]=(0,a.useState)(""),[y,f]=(0,a.useState)(""),[b,v]=(0,a.useState)(""),[w,N]=(0,a.useState)(!1),[j,D]=(0,a.useState)(!1),[P,C]=(0,a.useState)(!1),[S,k]=(0,a.useState)(""),[T,E]=(0,a.useState)(""),[A,M]=(0,a.useState)(!1),[U,_]=(0,a.useState)([]),[L,F]=(0,a.useState)(!0),[R,H]=(0,a.useState)(null),[q,I]=(0,a.useState)(0),O={ru:{title:"Настройки профиля",changePassword:"Изменить пароль",currentPassword:"Текущий пароль",newPassword:"Новый пароль",confirmPassword:"Подтвердите пароль",savePassword:"Сохранить пароль",passwordChanged:"Пароль успешно изменён",passwordMismatch:"Пароли не совпадают",passwordTooShort:"Пароль должен быть минимум 4 символа",wrongPassword:"Неверный текущий пароль",paymentHistory:"История покупок",noPurchases:"У вас пока нет покупок",status:"Статус",amount:"Сумма",date:"Дата",method:"Метод оплаты",access:"Доступ",photoDiary:"Фотодневник",diaryActive:"Активен до",diaryExpired:"Доступ истёк",daysLeft:"Осталось дней",pending:"Ожидание",processing:"Обработка",succeeded:"Успешно",failed:"Ошибка",refunded:"Возврат",cancelled:"Отменено",premiumDays:e=>"Премиум ".concat(e," дн."),backToDashboard:"Назад к панели"},en:{title:"Profile Settings",changePassword:"Change Password",currentPassword:"Current Password",newPassword:"New Password",confirmPassword:"Confirm Password",savePassword:"Save Password",passwordChanged:"Password changed successfully",passwordMismatch:"Passwords do not match",passwordTooShort:"Password must be at least 4 characters",wrongPassword:"Current password is incorrect",paymentHistory:"Purchase History",noPurchases:"You have no purchases yet",status:"Status",amount:"Amount",date:"Date",method:"Payment Method",access:"Access",photoDiary:"Photo Diary",diaryActive:"Active until",diaryExpired:"Access expired",daysLeft:"Days remaining",pending:"Pending",processing:"Processing",succeeded:"Success",failed:"Failed",refunded:"Refunded",cancelled:"Cancelled",premiumDays:e=>"Premium ".concat(e,"d"),backToDashboard:"Back to Dashboard"}},V=()=>{if(!(null==o?void 0:o.firstPhotoDiaryUpload)){H(null),I(null);return}let e=new Date(o.firstPhotoDiaryUpload),t=30;U.filter(e=>"succeeded"===e.status).forEach(e=>{var r,s;(null===(r=e.metadata)||void 0===r?void 0:r.type)==="marathon"||(null===(s=e.metadata)||void 0===s?void 0:s.planType)==="marathon"?t+=90:t+=30});let r=new Date(e);r.setDate(r.getDate()+t),H(r);let s=new Date,a=Math.ceil((r.getTime()-s.getTime())/864e5);I(a>0?a:0)},Y=async()=>{try{F(!0);let e=await m.WY.get(x.fI);e.payments&&_(e.payments)}catch(e){console.error("Error loading payment history:",e)}finally{F(!1)}};(0,a.useEffect)(()=>{if(!r){e.push("/auth/login");return}o&&Y()},[r,o]),(0,a.useEffect)(()=>{(null==o?void 0:o.createdAt)&&V()},[o,U]);let z=async t=>{if(t.preventDefault(),k(""),E(""),y.length<4){E(O[d].passwordTooShort);return}if(y!==b){E(O[d].passwordMismatch);return}try{M(!0),await m.WY.post(x.s4,{currentPassword:p,newPassword:y}),k(O[d].passwordChanged),g(""),f(""),v("")}catch(t){var r,s,a,l,o,n,i;(null==t?void 0:null===(r=t.response)||void 0===r?void 0:r.status)===401||(null==t?void 0:t.status)===401?(null==t?void 0:null===(l=t.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:null===(s=a.message)||void 0===s?void 0:s.includes("incorrect"))||(null==t?void 0:null===(o=t.message)||void 0===o?void 0:o.includes("incorrect"))?E(O[d].wrongPassword):e.push("/auth/login"):E((null==t?void 0:null===(i=t.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||(null==t?void 0:t.message)||"Error changing password")}finally{M(!1)}},B=e=>new Date(e).toLocaleDateString("ru"===d?"ru-RU":"en-US"),W=e=>{switch(e){case"succeeded":return"text-green-600";case"processing":return"text-blue-600";case"pending":return"text-yellow-600";case"failed":return"text-red-600";case"refunded":return"text-orange-600";default:return"text-gray-600"}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{children:(0,s.jsxs)("title",{children:[O[d].title," - Rejuvena"]})}),(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:[(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,s.jsx)("button",{onClick:()=>{h(e=>"ru"===e?"en":"ru")},className:"flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-shadow",children:(0,s.jsx)("span",{children:"ru"===d?"\uD83C\uDDF7\uD83C\uDDFA RU":"\uD83C\uDDFA\uD83C\uDDF8 EN"})})}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)(i(),{href:"/dashboard",className:"mb-4 inline-block transition-colors",style:{color:"var(--color-primary)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.8"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:["← ",O[d].backToDashboard]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg",style:{backgroundImage:"linear-gradient(to bottom right, var(--color-primary), var(--color-secondary))"},children:(null==o?void 0:o.firstName)?o.firstName.charAt(0).toUpperCase():"\uD83D\uDC64"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:O[d].title}),o&&(0,s.jsxs)("p",{className:"text-gray-600 mt-2",children:[o.firstName," ",o.lastName," • ",o.email]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:(0,s.jsx)(i(),{href:"/photo-diary",className:"transition-colors cursor-pointer",style:{color:"inherit"},onMouseEnter:e=>{e.currentTarget.style.color="var(--color-primary)"},onMouseLeave:e=>{e.currentTarget.style.color="inherit"},children:O[d].photoDiary})}),(0,s.jsx)("div",{className:"border rounded-lg p-4",style:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))",borderColor:"var(--color-primary-border, rgba(147, 51, 234, 0.3))"},children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-700 font-medium",children:O[d].diaryActive}),(0,s.jsx)("p",{className:"text-2xl font-bold mt-1",style:{color:"var(--color-primary)"},children:R?new Date(R).toLocaleDateString("ru-RU"):"Еще не началась"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-gray-600 text-sm",children:O[d].daysLeft}),(0,s.jsx)("p",{className:"text-3xl font-bold",style:{color:"var(--color-primary)"},children:null!==q?q:"-"})]})]})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Личные данные"}),(0,s.jsxs)("form",{className:"space-y-4",onSubmit:e=>{e.preventDefault();let r=new FormData(e.currentTarget),s=r.get("firstName"),a=r.get("lastName"),l=r.get("telegramUsername");fetch("".concat("http://localhost:9527","/api/auth/update-profile"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify({firstName:s,lastName:a,telegramUsername:l})}).then(e=>e.json()).then(e=>{o&&t((0,u.av)({...o,firstName:e.firstName,lastName:e.lastName,telegramUsername:e.telegramUsername})),alert("Профиль обновлен!")}).catch(e=>alert("Ошибка при обновлении профиля"))},children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Имя"}),(0,s.jsx)("input",{type:"text",name:"firstName",defaultValue:(null==o?void 0:o.firstName)||"",placeholder:"Введите имя",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Фамилия"}),(0,s.jsx)("input",{type:"text",name:"lastName",defaultValue:(null==o?void 0:o.lastName)||"",placeholder:"Введите фамилию",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"}})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telegram никнейм (опционально)"}),(0,s.jsx)("input",{type:"text",name:"telegramUsername",defaultValue:(null==o?void 0:o.telegramUsername)||"",placeholder:"@username",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"}}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Укажите ваш Telegram для получения уведомлений о покупках в боте"})]}),(0,s.jsx)("button",{type:"submit",className:"w-full text-white py-3 rounded-lg transition-colors",style:{backgroundColor:"var(--color-primary)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Сохранить изменения"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:O[d].changePassword}),(0,s.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:O[d].currentPassword}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:w?"text":"password",value:p,onChange:e=>g(e.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"},required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>N(!w),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:w?"\uD83D\uDE48":"\uD83D\uDC41️"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:O[d].newPassword}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:j?"text":"password",value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"},required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>D(!j),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:j?"\uD83D\uDE48":"\uD83D\uDC41️"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:O[d].confirmPassword}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:P?"text":"password",value:b,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"},required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>C(!P),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:P?"\uD83D\uDE48":"\uD83D\uDC41️"})]})]}),S&&(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:S}),T&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:T}),(0,s.jsx)("button",{type:"submit",disabled:A,className:"w-full text-white py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-primary)"},onMouseEnter:e=>{A||(e.currentTarget.style.opacity="0.9")},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:A?"...":O[d].savePassword})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:O[d].paymentHistory}),L?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Загрузка..."}):0===U.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:O[d].noPurchases}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[d].date}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[d].amount}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[d].method}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[d].access}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[d].status})]})}),(0,s.jsx)("tbody",{children:U.map(e=>{var t;return(0,s.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:B(e.createdAt)}),(0,s.jsxs)("td",{className:"py-3 px-4 font-semibold",children:[e.amount," ₽"]}),(0,s.jsx)("td",{className:"py-3 px-4 text-gray-600",children:"Альфа-банк"}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600",children:(null===(t=e.metadata)||void 0===t?void 0:t.duration)?"function"==typeof O[d].premiumDays?O[d].premiumDays(e.metadata.duration):"Premium ".concat(e.metadata.duration,"d"):e.description}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:"text-sm font-medium ".concat(W(e.status)),children:"succeeded"===e.status?O[d].succeeded:"processing"===e.status?O[d].processing:"pending"===e.status?O[d].pending:"failed"===e.status?O[d].failed:"refunded"===e.status?O[d].refunded:"cancelled"===e.status?O[d].cancelled:e.status})})]},e.id)})})]})})]})]})]})]})}},9008:function(e,t,r){e.exports=r(3867)}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=7858)}),_N_E=e.O()}]);