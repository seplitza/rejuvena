(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{7858:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile/settings",function(){return t(1958)}])},1958:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return x}});var a=t(5893),r=t(7294),n=t(1163),l=t(9008),d=t.n(l),o=t(1664),i=t.n(o),c=t(9133),u=t(6767),h=t(8256);function x(){let e=(0,n.useRouter)(),{isAuthenticated:s,user:t}=(0,c.C)(e=>e.auth),[l,o]=(0,r.useState)("ru"),[x,p]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[w,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[N,D]=(0,r.useState)(!1),[P,C]=(0,r.useState)(""),[S,k]=(0,r.useState)(""),[E,A]=(0,r.useState)(!1),[_,T]=(0,r.useState)([]),[F,M]=(0,r.useState)(!0),[H,L]=(0,r.useState)(null),[R,q]=(0,r.useState)(0),O={ru:{title:"Настройки профиля",changePassword:"Изменить пароль",currentPassword:"Текущий пароль",newPassword:"Новый пароль",confirmPassword:"Подтвердите пароль",savePassword:"Сохранить пароль",passwordChanged:"Пароль успешно изменён",passwordMismatch:"Пароли не совпадают",passwordTooShort:"Пароль должен быть минимум 4 символа",wrongPassword:"Неверный текущий пароль",paymentHistory:"История покупок",noPurchases:"У вас пока нет покупок",status:"Статус",amount:"Сумма",date:"Дата",method:"Метод оплаты",photoDiary:"Фотодневник",diaryActive:"Активен до",diaryExpired:"Доступ истёк",daysLeft:"Осталось дней",pending:"Ожидание",completed:"Завершено",failed:"Ошибка",cancelled:"Отменено",backToDashboard:"Назад к панели"},en:{title:"Profile Settings",changePassword:"Change Password",currentPassword:"Current Password",newPassword:"New Password",confirmPassword:"Confirm Password",savePassword:"Save Password",passwordChanged:"Password changed successfully",passwordMismatch:"Passwords do not match",passwordTooShort:"Password must be at least 4 characters",wrongPassword:"Current password is incorrect",paymentHistory:"Purchase History",noPurchases:"You have no purchases yet",status:"Status",amount:"Amount",date:"Date",method:"Payment Method",photoDiary:"Photo Diary",diaryActive:"Active until",diaryExpired:"Access expired",daysLeft:"Days remaining",pending:"Pending",completed:"Completed",failed:"Failed",cancelled:"Cancelled",backToDashboard:"Back to Dashboard"}};(0,r.useEffect)(()=>{if(!s){e.push("/auth/login");return}t&&Y()},[s,t]),(0,r.useEffect)(()=>{(null==t?void 0:t.createdAt)&&U()},[t,_]);let U=()=>{if(!(null==t?void 0:t.createdAt))return;let e=new Date(t.createdAt),s=30;_.filter(e=>"completed"===e.status).forEach(e=>{s+=30});let a=new Date(e);a.setDate(a.getDate()+s),L(a);let r=new Date,n=Math.ceil((a.getTime()-r.getTime())/864e5);q(n>0?n:0)},Y=async()=>{try{M(!0);let e=await u.WY.get(h.fI);T(Array.isArray(e.payments)?e.payments:[])}catch(t){var s;console.error("Failed to load payment history:",t),(null==t?void 0:null===(s=t.response)||void 0===s?void 0:s.status)===401&&e.push("/auth/login"),T([])}finally{M(!1)}},I=async s=>{if(s.preventDefault(),C(""),k(""),m.length<4){k(O[l].passwordTooShort);return}if(m!==y){k(O[l].passwordMismatch);return}try{A(!0),await u.WY.post(h.s4,{currentPassword:x,newPassword:m}),C(O[l].passwordChanged),p(""),g(""),b("")}catch(s){var t,a,r,n,d,o,i;(null==s?void 0:null===(t=s.response)||void 0===t?void 0:t.status)===401||(null==s?void 0:s.status)===401?(null==s?void 0:null===(n=s.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:null===(a=r.message)||void 0===a?void 0:a.includes("incorrect"))||(null==s?void 0:null===(d=s.message)||void 0===d?void 0:d.includes("incorrect"))?k(O[l].wrongPassword):e.push("/auth/login"):k((null==s?void 0:null===(i=s.response)||void 0===i?void 0:null===(o=i.data)||void 0===o?void 0:o.message)||(null==s?void 0:s.message)||"Error changing password")}finally{A(!1)}},W=e=>new Date(e).toLocaleDateString("ru"===l?"ru-RU":"en-US"),X=e=>{switch(e){case"completed":return"text-green-600";case"pending":return"text-yellow-600";case"failed":return"text-red-600";default:return"text-gray-600"}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d(),{children:(0,a.jsxs)("title",{children:[O[l].title," - Rejuvena"]})}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:[(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,a.jsx)("button",{onClick:()=>{o(e=>"ru"===e?"en":"ru")},className:"flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-shadow",children:(0,a.jsx)("span",{children:"ru"===l?"\uD83C\uDDF7\uD83C\uDDFA RU":"\uD83C\uDDFA\uD83C\uDDF8 EN"})})}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)(i(),{href:"/dashboard",className:"text-purple-600 hover:text-purple-700 mb-4 inline-block",children:["← ",O[l].backToDashboard]}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:O[l].title}),t&&(0,a.jsxs)("p",{className:"text-gray-600 mt-2",children:[t.firstName," ",t.lastName," • ",t.email]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:O[l].photoDiary}),H&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600",children:[O[l].diaryActive,":"]}),(0,a.jsx)("span",{className:"font-semibold ".concat(R>0?"text-green-600":"text-red-600"),children:W(H.toISOString())})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600",children:[O[l].daysLeft,":"]}),(0,a.jsx)("span",{className:"font-bold text-2xl text-purple-600",children:R})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:O[l].changePassword}),(0,a.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:O[l].currentPassword}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:w?"text":"password",value:x,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>f(!w),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:w?"\uD83D\uDE48":"\uD83D\uDC41️"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:O[l].newPassword}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:v?"text":"password",value:m,onChange:e=>g(e.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>j(!v),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:v?"\uD83D\uDE48":"\uD83D\uDC41️"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:O[l].confirmPassword}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:N?"text":"password",value:y,onChange:e=>b(e.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>D(!N),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:N?"\uD83D\uDE48":"\uD83D\uDC41️"})]})]}),P&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:P}),S&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:S}),(0,a.jsx)("button",{type:"submit",disabled:E,className:"w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:E?"...":O[l].savePassword})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:O[l].paymentHistory}),F?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Загрузка..."}):0===_.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:O[l].noPurchases}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[l].date}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[l].amount}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[l].method}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-600",children:O[l].status})]})}),(0,a.jsx)("tbody",{children:_.map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"py-3 px-4",children:W(e.createdAt)}),(0,a.jsxs)("td",{className:"py-3 px-4 font-semibold",children:[e.amount," ₽"]}),(0,a.jsx)("td",{className:"py-3 px-4 text-gray-600",children:e.paymentMethod}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("span",{className:"font-medium ".concat(X(e.status)),children:O[l][e.status]})})]},e._id))})]})})]})]})]})]})}},9008:function(e,s,t){e.exports=t(3867)}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=7858)}),_N_E=e.O()}]);