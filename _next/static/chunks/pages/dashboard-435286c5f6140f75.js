(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{528:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(6401)}])},6401:function(e,r,t){"use strict";t.r(r);var s=t(5893),a=t(7294),l=t(1163),o=t(9133),n=t(3031),c=t(803),i=t(8256),d=t(74);let m=e=>{let r=e.metadata;return r?"premium"===r.type||"premium"===r.planType?"Покупка: Премиум доступ":("marathon"===r.type||"marathon"===r.planType)&&r.marathonName?'Покупка: марафон "'.concat(r.marathonName,'"'):("exercise"===r.type||"exercise"===r.planType)&&r.exerciseName?'Покупка: упражнение "'.concat(r.exerciseName,'"'):"Покупка":"Покупка"};r.default=()=>{let e=(0,l.useRouter)(),r=(0,o.T)(),{user:t,isAuthenticated:x}=(0,o.C)(e=>e.auth),[u,h]=(0,a.useState)([]),[g,p]=(0,a.useState)([]),[y,b]=(0,a.useState)({}),[v,j]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let e=setTimeout(()=>{j(!1)},500);return()=>clearTimeout(e)},[]),(0,a.useEffect)(()=>{v||x||e.push("/auth/login")},[v,x,e]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=await c.WY.get(i.fI);e.payments&&h(e.payments.slice(0,5))}catch(e){console.error("Failed to load payments:",e)}},r=async()=>{try{let e=localStorage.getItem("auth_token");if(!e)return;let r=await fetch("".concat("https://api-rejuvena.duckdns.org","/api/marathons/user/my-enrollments"),{headers:{Authorization:"Bearer ".concat(e)}});if(r.ok){let e=await r.json();if(e.success&&Array.isArray(e.enrollments)){let r=e.enrollments.map(e=>({...e.marathonId,lastAccessedDay:e.lastAccessedDay||0,currentDay:e.currentDay||1})).filter(e=>e._id);p(r)}}}catch(e){console.error("\uD83D\uDCA5 Failed to load marathons:",e)}};x&&(console.log("\uD83D\uDD0D Dashboard user data:",{isPremium:null==t?void 0:t.isPremium,premiumEndDate:null==t?void 0:t.premiumEndDate,premiumEndDateType:typeof(null==t?void 0:t.premiumEndDate),fullUser:t}),e(),r())},[x,t]),(0,a.useEffect)(()=>{if(0===g.length)return;let e=()=>{let e={};g.forEach(r=>{let t=new Date().getTime(),s=new Date(r.startDate).getTime()-t;s<0?e[r._id]={days:0,hours:0,minutes:0,seconds:0,hasStarted:!0}:e[r._id]={days:Math.floor(s/864e5),hours:Math.floor(s%864e5/36e5),minutes:Math.floor(s%36e5/6e4),seconds:Math.floor(s%6e4/1e3),hasStarted:!1}}),b(e)};e();let r=setInterval(e,1e3);return()=>clearInterval(r)},[g]),v||!x)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Загрузка..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8 flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Личный кабинет"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[x&&t&&(0,s.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-md cursor-pointer hover:shadow-lg transition-shadow",style:{backgroundImage:"linear-gradient(to bottom right, var(--color-primary), var(--color-secondary))"},onClick:()=>e.push("/profile/settings"),title:"".concat(t.firstName||"Профиль"),children:t.firstName?t.firstName.charAt(0).toUpperCase():"\uD83D\uDC64"}),(0,s.jsx)("button",{onClick:()=>{x&&(r((0,n.kS)()),c.VH.remove()),e.push("/auth/login")},className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:x?"Выйти":"Войти"})]})]})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,s.jsxs)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:["Здравствуйте",(null==t?void 0:t.firstName)?", ".concat(t.firstName):"","!"]}),!(null==t?void 0:t.firstName)&&(0,s.jsx)("p",{className:"text-gray-500 text-sm mb-3",children:"Заполните профиль, пожалуйста, что бы мы могли к Вам правильно обращаться."}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Email: ",(null==t?void 0:t.email)||"Не указан"]})]}),(null==t?void 0:t.isPremium)&&(0,s.jsx)("div",{className:"mb-6 rounded-lg shadow-lg p-6 text-white",style:{backgroundImage:"linear-gradient(to right, var(--color-primary), var(--color-secondary))"},children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-2",children:"✨ Премиум доступ активен"}),(0,s.jsxs)("p",{className:"opacity-90",children:["Активен до: ",(null==t?void 0:t.premiumEndDate)?new Date(t.premiumEndDate).toLocaleDateString("ru-RU"):"неизвестно"]}),(null==t?void 0:t.premiumEndDate)&&(0,s.jsxs)("p",{className:"opacity-90 mt-1",children:["Осталось дней: ",Math.max(0,Math.ceil((new Date(t.premiumEndDate).getTime()-new Date().getTime())/864e5))]}),(0,s.jsx)("p",{className:"opacity-90 mt-1",children:"\uD83C\uDFAF Разблокирован доступ ко всем упражнениям"})]}),(0,s.jsx)("div",{className:"text-6xl",children:"\uD83D\uDC51"})]})}),g.length>0&&(0,s.jsx)("div",{className:"mb-6 space-y-4",children:g.map(r=>{var t;let a=y[r._id],l=null===(t=null==a?void 0:a.hasStarted)||void 0===t||t,o=(r.lastAccessedDay||0)>0,n=l?"/marathons/".concat(r._id,"/day/").concat((()=>{if(!l)return 1;let e=new Date,t=new Date(r.startDate);return Math.max(1,Math.min(Math.floor((e.getTime()-t.getTime())/864e5)+1,r.numberOfDays))})()):"/marathons/".concat(r._id,"/start");return(0,s.jsx)("div",{className:"rounded-lg shadow-lg p-6 text-white cursor-pointer hover:shadow-xl transition-shadow",style:{backgroundImage:"linear-gradient(to right, var(--color-accent), var(--color-secondary))"},onClick:()=>e.push(n),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsxs)("h3",{className:"text-2xl font-bold",children:["\uD83C\uDFAF ",r.title]}),(0,s.jsx)("span",{className:"text-xs bg-white/30 px-3 py-1 rounded-full font-semibold",children:"Марафон оплачен"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-orange-100 flex items-center gap-2",children:[(0,s.jsx)("span",{children:"\uD83D\uDCC5"}),(0,s.jsxs)("span",{children:["Длительность обучения: ",r.numberOfDays," дней"]})]}),(0,s.jsxs)("p",{className:"text-orange-100 flex items-center gap-2",children:[(0,s.jsx)("span",{children:"\uD83C\uDFC3"}),(0,s.jsx)("span",{children:"Курс практики: 30 дней"})]}),(0,s.jsxs)("p",{className:"text-orange-100 flex items-center gap-2",children:[(0,s.jsx)("span",{children:"\uD83D\uDDD3️"}),(0,s.jsxs)("span",{children:["Старт: ",new Date(r.startDate).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]}),!l&&a&&(0,s.jsxs)("div",{className:"mt-4 bg-white/20 rounded-lg p-4 backdrop-blur-sm",children:[(0,s.jsx)("p",{className:"text-sm font-semibold mb-2",children:"⏰ До старта марафона:"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold",children:a.days}),(0,s.jsx)("div",{className:"text-xs text-orange-200",children:"дней"})]}),(0,s.jsx)("div",{className:"text-3xl font-bold",children:":"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold",children:String(a.hours).padStart(2,"0")}),(0,s.jsx)("div",{className:"text-xs text-orange-200",children:"часов"})]}),(0,s.jsx)("div",{className:"text-3xl font-bold",children:":"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold",children:String(a.minutes).padStart(2,"0")}),(0,s.jsx)("div",{className:"text-xs text-orange-200",children:"минут"})]}),(0,s.jsx)("div",{className:"text-3xl font-bold",children:":"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold",children:String(a.seconds).padStart(2,"0")}),(0,s.jsx)("div",{className:"text-xs text-orange-200",children:"секунд"})]})]})]}),l&&(0,s.jsx)("div",{className:"mt-2 text-orange-100",children:"✨ Разблокирован доступ ко всем упражнениям марафона"})]})]}),(0,s.jsxs)("div",{className:"ml-6 flex-shrink-0",children:[(0,s.jsx)("div",{className:"text-7xl mb-2",children:"\uD83C\uDFC3"}),(0,s.jsx)("button",{className:"bg-white text-orange-600 font-bold px-6 py-3 rounded-lg hover:bg-orange-50 transition-colors whitespace-nowrap",children:l?o?"Перейти в марафон →":"Начать марафон →":"Подробнее →"})]})]})},r._id)})}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(d.Z,{})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg transition-colors text-left group border",style:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))",borderColor:"var(--color-primary-border, rgba(147, 51, 234, 0.3))"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light-hover, rgba(147, 51, 234, 0.2))"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light, rgba(147, 51, 234, 0.1))"},onClick:()=>e.push("/courses"),children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCDA"}),(0,s.jsx)("span",{className:"text-base font-medium",style:{color:"#1F2937"},onMouseEnter:e=>{e.currentTarget.style.color="var(--color-primary)"},onMouseLeave:e=>{e.currentTarget.style.color="#1F2937"},children:"Мои курсы"})]}),(0,s.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg transition-colors text-left group border",style:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))",borderColor:"var(--color-primary-border, rgba(147, 51, 234, 0.3))"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light-hover, rgba(147, 51, 234, 0.2))"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light, rgba(147, 51, 234, 0.1))"},onClick:()=>e.push("/exercises"),children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83C\uDFCB️"}),(0,s.jsx)("span",{className:"text-base font-medium",style:{color:"#1F2937"},onMouseEnter:e=>{e.currentTarget.style.color="var(--color-primary)"},onMouseLeave:e=>{e.currentTarget.style.color="#1F2937"},children:"Упражнения"})]}),(0,s.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg transition-colors text-left group border",style:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))",borderColor:"var(--color-primary-border, rgba(147, 51, 234, 0.3))"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light-hover, rgba(147, 51, 234, 0.2))"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light, rgba(147, 51, 234, 0.1))"},onClick:()=>e.push("/photo-diary"),children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCF8"}),(0,s.jsx)("span",{className:"text-base font-medium",style:{color:"#1F2937"},onMouseEnter:e=>{e.currentTarget.style.color="var(--color-primary)"},onMouseLeave:e=>{e.currentTarget.style.color="#1F2937"},children:"Фото-дневник"})]}),(0,s.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg transition-colors text-left group border",style:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))",borderColor:"var(--color-primary-border, rgba(147, 51, 234, 0.3))"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light-hover, rgba(147, 51, 234, 0.2))"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light, rgba(147, 51, 234, 0.1))"},onClick:()=>e.push("/profile/settings"),children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83D\uDC64"}),(0,s.jsx)("span",{className:"text-base font-medium",style:{color:"#1F2937"},onMouseEnter:e=>{e.currentTarget.style.color="var(--color-primary)"},onMouseLeave:e=>{e.currentTarget.style.color="#1F2937"},children:"Профиль"})]})]})}),x&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Последняя активность"}),0===u.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-gray-400 text-5xl mb-2",children:"\uD83D\uDCED"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Активности пока нет"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Начните с выбора курса!"})]}):(0,s.jsx)("div",{className:"space-y-3",children:u.map(r=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>"succeeded"===r.status&&e.push("/payment/success?orderId=".concat(r.id)),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"text-2xl",children:"succeeded"===r.status?"✅":"processing"===r.status?"⏳":"failed"===r.status?"❌":"⏸️"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-800",children:"succeeded"===r.status?"Оплата принята":"processing"===r.status?"Обработка оплаты":"failed"===r.status?"Оплата не прошла":"Ожидание оплаты"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:m(r)})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-bold text-gray-800",children:[r.amount," ₽"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:new Date(r.createdAt).toLocaleDateString("ru-RU")})]})]},r.id))})]})]})]})}}},function(e){e.O(0,[74,888,774,179],function(){return e(e.s=528)}),_N_E=e.O()}]);