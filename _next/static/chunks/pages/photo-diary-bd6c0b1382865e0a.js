(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9],{7049:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/photo-diary",function(){return l(410)}])},410:function(e,t,l){"use strict";l.r(t);var o=l(5893),r=l(7294),a=l(1163),n=l(9133),s=l(9008),i=l.n(s),c=l(3031),d=l(2374),u=l(9997);let h=[{id:"front",label:"Вид спереди",example:"https://api-rejuvena.duckdns.org/uploads/example-front.png?v=2"},{id:"left34",label:"3/4 слева",example:"https://api-rejuvena.duckdns.org/uploads/example-left34.png?v=2"},{id:"leftProfile",label:"Профиль слева",example:"https://api-rejuvena.duckdns.org/uploads/example-left-profile.png?v=2"},{id:"right34",label:"3/4 справа",example:"https://api-rejuvena.duckdns.org/uploads/example-right34.png?v=2"},{id:"rightProfile",label:"Профиль справа",example:"https://api-rejuvena.duckdns.org/uploads/example-right-profile.png?v=2"},{id:"closeup",label:"твоё\nпроблемное\nместо\nкрупный план",example:"https://api-rejuvena.duckdns.org/uploads/example-closeup.png?v=2"}];t.default=()=>{let e=(0,a.useRouter)(),{user:t,isAuthenticated:s}=(0,n.C)(e=>e.auth),[m,x]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),p=(0,n.T)(),[b,v]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),[y,N]=(0,r.useState)(null),D=(0,r.useRef)(!1),[k,C]=(0,r.useState)(!1),[A,M]=(0,r.useState)(new Set),[S,L]=(0,r.useState)(!1),B=(0,r.useRef)(new Set),[E,I]=(0,r.useState)(!1),[P,_]=(0,r.useState)(null),[F,R]=(0,r.useState)({x:0,y:0,width:300,height:300}),[O,T]=(0,r.useState)(1);(0,r.useRef)(null);let[U,z]=(0,r.useState)({before:{front:null,left34:null,leftProfile:null,right34:null,rightProfile:null,closeup:null},after:{front:null,left34:null,leftProfile:null,right34:null,rightProfile:null,closeup:null},botAgeBefore:null,botAgeAfter:null,realAgeBefore:null,realAgeAfter:null,weightBefore:null,weightAfter:null,heightBefore:null,heightAfter:null,commentBefore:"",commentAfter:""}),[X,W]=(0,r.useState)({before:{front:null,left34:null,leftProfile:null,right34:null,rightProfile:null,closeup:null},after:{front:null,left34:null,leftProfile:null,right34:null,rightProfile:null,closeup:null}}),[q,V]=(0,r.useState)({before:{},after:{}}),H=async(e,t)=>{if(!e)return null;try{if(void 0!==t){let l=new Image,o=new Promise((e,t)=>{l.onload=()=>e(),l.onerror=()=>t(Error("Failed to load image"))});l.src=e,await o;let r=document.createElement("canvas"),a=r.getContext("2d");if(!a)return e;return r.width=l.width,r.height=l.height,a.drawImage(l,0,0),r.toDataURL("image/jpeg",t)}let l=e.length-(e.indexOf(",")+1),o=3*l/4/1048576;if(console.log("\uD83D\uDCCF Image size: ".concat(o.toFixed(2)," MB")),o<=2)return console.log("✅ File ≤2MB, storing without compression"),e;console.log("\uD83D\uDDDC️ File >2MB, compressing to 60%");let r=new Image,a=new Promise((e,t)=>{r.onload=()=>e(),r.onerror=()=>t(Error("Failed to load image"))});r.src=e,await a;let n=document.createElement("canvas"),s=n.getContext("2d");if(!s)return e;return n.width=r.width,n.height=r.height,s.drawImage(r,0,0),n.toDataURL("image/jpeg",.6)}catch(t){return console.error("Failed to compress image:",t),e}},J=e=>new Promise(t=>{let l=new Image;l.onload=()=>{let o=document.createElement("canvas");o.width=l.width,o.height=l.height;let r=o.getContext("2d");if(!r){t(e);return}r.drawImage(l,0,0),t(o.toDataURL("image/jpeg",.5))},l.onerror=()=>t(e),l.src=e}),Y=async()=>{if(s&&(null==t?void 0:t._id))try{let e=localStorage.getItem("auth_token"),l=await fetch("".concat("http://localhost:9527","/api/photo-diary/mark-first-upload"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(l.ok){let e=await l.json();console.log("✅ First photo diary upload marked:",e.firstPhotoDiaryUpload),p((0,c.av)({...t,firstPhotoDiaryUpload:e.firstPhotoDiaryUpload}))}}catch(e){console.error("❌ Failed to mark first photo upload:",e)}},G=async(e,o,r)=>{if(!(null==t?void 0:t._id)){console.log("⚠️ No user ID, skipping metadata save");return}try{let t=new Image;t.src=e,await new Promise((e,l)=>{t.onload=e,t.onerror=l});let a=null;try{let e=(await l.e(918).then(l.t.bind(l,2918,23))).default||await l.e(918).then(l.t.bind(l,2918,23)),o=await new Promise(l=>{e.getData(t,function(){l(e.getAllTags(this))})});console.log("\uD83D\uDCF7 EXIF tags extracted:",o);let r=(null==o?void 0:o.DateTimeOriginal)||(null==o?void 0:o.DateTime);if(r){let e=r.split(" "),t=e[0].replace(/:/g,"-"),l=e[1]||"00:00:00",n=new Date("".concat(t,"T").concat(l)).toISOString();a={DateTime:r,captureDate:n,camera:(null==o?void 0:o.Make)?"".concat(o.Make," ").concat(o.Model||"").trim():null,orientation:null==o?void 0:o.Orientation},console.log("✅ EXIF date found:",n)}else Object.keys(o||{}).length>0?(a={reason:"EXIF found but no capture date",camera:(null==o?void 0:o.Make)?"".concat(o.Make," ").concat(o.Model||"").trim():null},console.log("⚠️ EXIF found but no date")):(a={reason:"No EXIF data found (screenshot or edited photo)"},console.log("⚠️ No EXIF data"))}catch(e){console.error("❌ EXIF extraction error:",e),a={reason:"No EXIF data found (screenshot or edited photo)"}}let n=new Date().toISOString();V(e=>({...e,[o]:{...e[o],[r]:{uploadDate:n,exifData:a}}})),console.log("✅ Metadata saved for ".concat(r," (").concat(o,"):"),{uploadDate:n,exifData:a})}catch(e){console.error("❌ Failed to save metadata:",e)}};(0,r.useEffect)(()=>{if(s&&(null==t?void 0:t._id)&&D.current){let e="photo_diary_metadata_".concat(t._id);try{localStorage.setItem(e,JSON.stringify(q)),console.log("\uD83D\uDCBE Metadata saved to localStorage")}catch(e){console.error("❌ LocalStorage save error:",e)}}},[q,s,t]),(0,r.useEffect)(()=>{!s&&parseInt(localStorage.getItem("rejuvena_upload_count_".concat("guest"))||"0",10)>=3&&C(!0)},[s]),(0,r.useEffect)(()=>{(null==t?void 0:t._id)&&!D.current&&s&&(async()=>{await Q();let e="photo_diary_metadata_".concat(t._id),l=localStorage.getItem(e);if(l)try{let e=JSON.parse(l);V(e),console.log("\uD83D\uDCC5 Loaded metadata from localStorage")}catch(e){console.error("❌ Failed to load metadata:",e)}D.current=!0,console.log("✅ Data load complete")})()},[null==t?void 0:t._id,s]),(0,r.useEffect)(()=>{let e=async()=>{try{let e="/rejuvena/models";await d.qB.tinyFaceDetector.loadFromUri(e),await d.qB.faceLandmark68Net.loadFromUri(e),v(!0),console.log("✅ Face-api models loaded")}catch(e){console.error("❌ Failed to load face-api models:",e)}};b||e()},[b]),(0,r.useEffect)(()=>{let e=e=>{if(B.current.size>0)return e.preventDefault(),e.returnValue="Фотографии ещё загружаются на сервер. Если вы уйдёте, они не сохранятся. Остаться на странице?",e.returnValue};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[]),(0,r.useEffect)(()=>{B.current=A},[A]);let K=async(e,t)=>new Promise((l,o)=>{let r=new Image;r.onload=async()=>{try{let e=await d.bd(r,new d.aK).withFaceLandmarks();if(!e){o(Error("Лицо не найдено на фотографии"));return}let{box:a}=e.detection,n=document.createElement("canvas"),s=n.getContext("2d"),i="closeup"===t?0:.2,c=a.height/(1-i-("closeup"===t?0:.15)),u=a.y-c*i,h=a.x+a.width/2-c/2;n.width=c,n.height=c,s.drawImage(r,h,u,c,c,0,0,c,c),l(n.toDataURL("image/jpeg",.95))}catch(e){o(e)}},r.onerror=()=>o(Error("Ошибка загрузки изображения")),r.src=e}),Z=async(e,t,l)=>{let o="".concat(t,"_").concat(l);try{M(e=>new Set([...e,o])),L(!1),console.log("\uD83D\uDCBE Saving ".concat(l," photo for ").concat(t," to server..."));let r="before"===t,a=await fetch("".concat("http://localhost:9527","/api/photo-diary/save-photo"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify({image:e,photoType:l,isBeforePhoto:r})});if(!a.ok)throw Error("Ошибка сохранения фото");let n=await a.json();return console.log("✅ Photo saved to server:",n.photoUrl),n.photoUrl}catch(e){return console.error("❌ Photo save error:",e),null}finally{M(e=>{let t=new Set(e);return t.delete(o),0===t.size&&(L(!0),setTimeout(()=>L(!1),5e3)),t})}},Q=async()=>{try{let e=await fetch("".concat("http://localhost:9527","/api/photo-diary/photos"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}});if(!e.ok)throw Error("Failed to load photos");let t=await e.json();if(t.success&&t.photos){let e=t.photos,l=e=>e?e.startsWith("http")?e:"".concat("http://localhost:9527").concat(e):null;z(t=>({...t,before:{front:l(e.before.front),left34:l(e.before.left34),leftProfile:l(e.before.leftProfile),right34:l(e.before.right34),rightProfile:l(e.before.rightProfile),closeup:l(e.before.closeup)},after:{front:l(e.after.front),left34:l(e.after.left34),leftProfile:l(e.after.leftProfile),right34:l(e.after.right34),rightProfile:l(e.after.rightProfile),closeup:l(e.after.closeup)}})),console.log("✅ Photos loaded from server")}}catch(e){console.error("❌ Failed to load photos from server:",e)}},$=async(e,t)=>{console.log("\uD83C\uDFAF Calling estimateAge for ".concat(t,"..."));try{let l=e.split(",")[1];console.log("\uD83D\uDCF8 Image size: ".concat(l.length," chars"));let o=await fetch("https://api.seplitza.ru/api/estimate-age",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:l})});if(console.log("\uD83D\uDCE1 API response status: ".concat(o.status)),!o.ok)throw Error("Ошибка определения возраста");let r=await o.json();console.log("✅ Age API response:",r),r.success&&r.age?(console.log("\uD83C\uDF82 Setting age ".concat(r.age," for ").concat(t)),"before"===t?z(e=>({...e,botAgeBefore:r.age})):z(e=>({...e,botAgeAfter:r.age}))):console.error("❌ Age estimation failed:",r.message)}catch(l){console.error("❌ Age estimation error:",l);let e=Math.floor(11*Math.random())+130;"before"===t?z(t=>({...t,botAgeBefore:e})):z(t=>({...t,botAgeAfter:e}))}},ee=async(e,l,o)=>{N(null),w(!0);try{let r=(null==t?void 0:t._id)||"guest",a="rejuvena_upload_count_".concat(r),n=parseInt(localStorage.getItem(a)||"0",10);localStorage.setItem(a,String(n+1)),console.log("\uD83D\uDCCA Upload count: ".concat(n+1));let s=new FileReader;s.onload=async t=>{var o;let r=null===(o=t.target)||void 0===o?void 0:o.result;await G(r,e,l),await Y();let a=await J(r);if(W(t=>({...t,[e]:{...t[e],[l]:a}})),"leftProfile"===l||"rightProfile"===l||"closeup"===l){let t=await H(r,.6);z(o=>({...o,[e]:{...o[e],[l]:t}})),w(!1),setTimeout(()=>et(e,l),100);return}if(!b){N("Модели распознавания лиц еще загружаются. Попробуйте через несколько секунд."),w(!1);return}try{let t=await K(r,l),o=await Z(t,e,l);if(z(r=>({...r,[e]:{...r[e],[l]:o||t}})),console.log("\uD83D\uDCF7 Photo uploaded: ".concat(l," for ").concat(e)),"front"===l){console.log("\uD83D\uDD0D Front photo detected - calling estimateAge"),await $(t,e),console.log("\uD83D\uDD04 Auto-filling closeup (row 6) with front photo (0% crop)");try{let t=await K(r,"closeup"),l=await Z(t,e,"closeup");z(o=>({...o,[e]:{...o[e],closeup:l||t}})),console.log("✅ Closeup auto-filled from front photo")}catch(e){console.error("⚠️ Failed to auto-fill closeup: ".concat(e))}}else console.log("⏭️ Skipping age estimation for ".concat(l));w(!1)}catch(t){console.error("Crop error:",t),N(t.message||"Не удалось обработать фото"),confirm("Не удалось автоматически обрезать фото. Загрузить как есть?")&&z(t=>({...t,[e]:{...t[e],[l]:r}})),w(!1)}},s.readAsDataURL(o)}catch(e){console.error("File upload error:",e),w(!1)}},et=(e,t)=>{let l=X[e][t],o=l||U[e][t];if(o){let r=new Image;r.onload=()=>{let a=r.width,n=r.height,s=Math.min(a,n,400),i=(a-s)/2,c=(n-s)/2;_({dataUrl:o,period:e,photoType:t}),R({x:Math.max(0,i),y:Math.max(0,c),width:s,height:s}),T(1),I(!0),l?console.log("\uD83D\uDCF7 Opening crop modal with ORIGINAL photo for ".concat(t," (").concat(a,"x").concat(n,")")):console.log("⚠️ No original found, using current photo for ".concat(t," (").concat(a,"x").concat(n,")"))},r.src=o}},el=async()=>{if(P){w(!0);try{let e=new Image;e.onload=async()=>{let t=e.naturalWidth,l=e.naturalHeight,o=document.querySelector(".crop-modal-image");if(!o){console.error("❌ Modal image not found");return}let r=o.width,a=o.height,n=t/r,s=l/a,i=Math.round(F.x*n),c=Math.round(F.y*s),d=Math.round(F.width*n),u=Math.round(F.height*s);console.log("\uD83D\uDD0D Crop coordinates:\n          Display: (".concat(F.x,", ").concat(F.y,") ").concat(F.width,"x").concat(F.height,"\n          Image: ").concat(r,"x").concat(a," → ").concat(t,"x").concat(l,"\n          Scale: ").concat(n.toFixed(2),"x, ").concat(s.toFixed(2),"x\n          Actual: (").concat(i,", ").concat(c,") ").concat(d,"x").concat(u));let h=document.createElement("canvas");h.width=d,h.height=u;let m=h.getContext("2d");if(!m)return;m.drawImage(e,i,c,d,u,0,0,d,u),h.toDataURL("image/jpeg",.95);let x=Math.min(1,800/Math.max(d,u)),g=Math.round(d*x),f=Math.round(u*x),p=document.createElement("canvas");p.width=g,p.height=f;let b=p.getContext("2d");if(!b)return;b.drawImage(h,0,0,g,f);let v=p.toDataURL("image/jpeg",.6);z(e=>({...e,[P.period]:{...e[P.period],[P.photoType]:v}})),I(!1),_(null),w(!1),console.log("✂️ Manual crop applied (from preview, server crop TODO)")},e.src=P.dataUrl}catch(e){console.error("Crop failed:",e),alert("Не удалось обрезать изображение"),w(!1)}}},eo=async()=>{try{var e,l;w(!0);let o=[];if(["front","left34","leftProfile","right34","rightProfile","closeup"].forEach(e=>{let t=!!U.before[e],l=!!U.after[e];(t||l)&&o.push({beforePhoto:U.before[e]||null,afterPhoto:U.after[e]||null,photoType:e})}),0===o.length){alert("Загрузите хотя бы одну фотографию для создания коллажа!"),w(!1);return}console.log("\uD83C\uDFA8 Creating collage with ".concat(o.length," rows..."));let r=await fetch("https://api.seplitza.ru/api/create-collage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:o,metadata:q,userInfo:{username:(null==t?void 0:null===(e=t.email)||void 0===e?void 0:e.split("@")[0])||(null==t?void 0:t.firstName)||"Пользователь",realAgeBefore:U.realAgeBefore,realAgeAfter:U.realAgeAfter,weightBefore:U.weightBefore,weightAfter:U.weightAfter,heightBefore:U.heightBefore,heightAfter:U.heightAfter,commentsBefore:U.commentBefore,commentsAfter:U.commentAfter}})});if(!r.ok)throw Error("Ошибка создания коллажа");let a=await r.json();if(a.success&&a.collage){let e=(null==t?void 0:null===(l=t.email)||void 0===l?void 0:l.split("@")[0])||(null==t?void 0:t.firstName)||"user",o=new Date().toLocaleDateString("ru-RU").replace(/\./g,"-"),r="Фотодневник_".concat(e,"_").concat(o,".jpg"),n=a.collage.split(",")[1],s=atob(n),i=Array(s.length);for(let e=0;e<s.length;e++)i[e]=s.charCodeAt(e);let c=new Uint8Array(i),d=new Blob([c],{type:"image/jpeg"});if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){let e=document.createElement("a");e.href=a.collage,e.download=r,e.style.display="none",document.body.appendChild(e),setTimeout(()=>{e.click(),document.body.removeChild(e),console.log("✅ Collage download triggered (mobile)")},100)}else{let e=URL.createObjectURL(d),t=document.createElement("a");t.href=e,t.download=r,document.body.appendChild(t),t.click(),document.body.removeChild(t),setTimeout(()=>URL.revokeObjectURL(e),100),console.log("✅ Collage downloaded (desktop)")}}else throw Error("Не удалось создать коллаж");w(!1)}catch(e){console.error("❌ Collage error:",e),alert("Ошибка при создании коллажа. Попробуйте еще раз."),w(!1)}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.Z,{isOpen:g,onClose:()=>f(!1)}),(0,o.jsx)(i(),{children:(0,o.jsx)("title",{children:"Фотодневник - Rejuvena"})}),k&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,o.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:"\uD83C\uDF89 Отличное начало!"}),(0,o.jsx)("p",{className:"text-gray-700 mb-4",children:"Вы загрузили уже 3 фото. Чтобы продолжить и получить доступ ко всем функциям:"}),(0,o.jsxs)("ul",{className:"text-sm text-gray-600 mb-4 space-y-2",children:[(0,o.jsx)("li",{children:"✅ Генерация персональной ссылки с вашим username"}),(0,o.jsx)("li",{children:"✅ Уведомления об удалении фото (за 7, 3 и 1 день)"}),(0,o.jsx)("li",{children:"✅ Сохранение прогресса в облаке"}),(0,o.jsx)("li",{children:"✅ Доступ к истории фотодневника"})]}),(0,o.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"После регистрации вы сможете настроить уведомления Telegram."}),(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)("button",{onClick:()=>{C(!1);let l=(null==t?void 0:t._id)||"guest",o=(null==t?void 0:t.username)||"";e.push("/generate-link?prefill=true&tg_user_id=".concat(l,"&tg_username=").concat(o))},className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Настроить доступ"}),(0,o.jsx)("button",{onClick:()=>{C(!1),e.push("/auth/login")},className:"flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors",children:"Войти"})]}),(0,o.jsx)("button",{onClick:()=>C(!1),className:"mt-3 w-full text-sm text-gray-500 hover:text-gray-700",children:"Продолжить без регистрации"})]})}),(0,o.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,o.jsxs)("header",{className:"bg-white border-b",children:[(0,o.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,o.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"text-blue-700 hover:text-blue-800",children:(0,o.jsx)("svg",{className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full mr-3 flex items-center justify-center",children:(0,o.jsxs)("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-blue-800",children:"Rejuvena"})]}),(0,o.jsx)("button",{onClick:()=>f(!0),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Меню",children:(0,o.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),(0,o.jsx)("div",{className:"border-b",children:(0,o.jsxs)("div",{className:"max-w-7xl mx-auto px-4 flex items-center justify-between py-2",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-blue-800",children:"Фотодневник"}),(0,o.jsx)("button",{onClick:()=>x(!0),className:"text-blue-700 underline font-medium",children:"правила"})]})})]}),(0,o.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,o.jsxs)("div",{className:"mb-6 text-blue-800 space-y-3 text-sm leading-relaxed",children:[(0,o.jsx)("p",{className:"font-bold",children:"Время загрузить твои новые фото!"}),(0,o.jsx)("p",{children:"Сделай 6 снимков, как показано в примерах. После окончания каждого курса возвращайся сюда с новым набором из 6 фотографий и зафиксируй изменения \xabДо\xbb и \xabПосле\xbb."}),(0,o.jsx)("p",{children:"Ты сможешь скачать коллаж с результатами, чтобы поделиться им или оставить себе на память."}),(0,o.jsx)("p",{className:"font-bold",children:"Удачи!"})]}),(0,o.jsxs)("div",{className:"mb-6 bg-pink-50 border border-pink-200 rounded-lg p-3 flex items-center",children:[(0,o.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,o.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCA1"})}),(0,o.jsxs)("p",{className:"text-sm text-blue-800 flex-1",children:[(0,o.jsx)("span",{className:"font-bold",children:"Совет!"})," При съёмке держите камеру горизонтально"]}),(0,o.jsxs)("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[(0,o.jsx)("div",{className:"w-12 h-10 bg-white border-2 border-blue-800 rounded flex items-center justify-center",children:(0,o.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-300"})}),(0,o.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC4C"}),(0,o.jsx)("div",{className:"w-10 h-12 bg-white border-2 border-red-500 rounded flex items-center justify-center",children:(0,o.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-300"})}),(0,o.jsx)("span",{className:"text-2xl",children:"❌"})]})]}),(0,o.jsx)("div",{className:"mb-6 bg-blue-50 border-2 border-blue-300 rounded-lg p-4 cursor-pointer hover:bg-blue-100 transition-colors",onClick:()=>{let e=document.getElementById("storage-policy-detail");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,o.jsx)("p",{className:"font-bold text-base text-blue-800",children:"Хранение фотографий и автосохранение"})]}),(0,o.jsx)("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)("h3",{className:"text-lg font-bold text-blue-800",children:"Пример"})}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)("h3",{className:"text-lg font-bold text-blue-800",children:"До"})}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)("h3",{className:"text-lg font-bold text-blue-800",children:"После"})})]}),j&&(0,o.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600 mr-3"}),(0,o.jsx)("span",{className:"text-blue-800",children:"Обработка фото..."})]}),y&&(0,o.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,o.jsx)("p",{className:"text-red-800",children:y})}),A.size>0&&(0,o.jsxs)("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-300 rounded-lg flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-yellow-600 mr-3"}),(0,o.jsxs)("span",{className:"text-yellow-800 font-medium",children:["Сохранение на сервер... (",A.size," фото)"]})]}),(0,o.jsx)("span",{className:"text-xs text-yellow-700",children:"Не закрывайте страницу"})]}),S&&(0,o.jsxs)("div",{className:"mb-4 p-4 bg-green-50 border border-green-300 rounded-lg flex items-center",children:[(0,o.jsx)("svg",{className:"h-5 w-5 text-green-600 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,o.jsx)("span",{className:"text-green-800 font-medium",children:"✓ Все фотографии сохранены на сервер"})]}),(0,o.jsx)("div",{className:"space-y-4",children:h.map(e=>{var t,l,r,a,n,s,i,c;return(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{className:"flex flex-col items-center",children:[(0,o.jsx)("div",{className:"w-full aspect-square bg-gray-200 rounded-lg overflow-hidden border-2 border-gray-300 mb-2",children:(0,o.jsx)("img",{src:e.example,alt:"Пример ".concat(e.label),className:"w-full h-full object-contain"})}),(0,o.jsx)("p",{className:"text-sm font-medium text-blue-800 text-center whitespace-pre-line",children:e.label})]}),(0,o.jsxs)("div",{className:"flex flex-col items-center",children:[(0,o.jsx)("div",{className:"w-full aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-blue-300 mb-2 relative group",children:U.before[e.id]?(0,o.jsxs)("div",{className:"w-full h-full relative",children:[(0,o.jsx)("img",{src:U.before[e.id],alt:"До",className:"w-full h-full object-contain"}),(0,o.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-200 flex flex-col items-center justify-center gap-2",children:[(0,o.jsxs)("label",{className:"text-white font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer hover:underline",children:["Изменить",(0,o.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:j,onChange:t=>{var l;let o=null===(l=t.target.files)||void 0===l?void 0:l[0];o&&ee("before",e.id,o)}})]}),(0,o.jsx)("button",{onClick:()=>et("before",e.id),className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:underline",disabled:j,children:"Корректировать"})]})]}):(0,o.jsxs)("label",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-gray-200 transition",children:[(0,o.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:j,onChange:t=>{var l;let o=null===(l=t.target.files)||void 0===l?void 0:l[0];o&&ee("before",e.id,o)}}),(0,o.jsx)("span",{className:"text-blue-600 font-medium",children:j?"Обработка...":"загрузить"})]})}),q.before[e.id]&&(0,o.jsxs)("div",{className:"text-[11px] sm:text-xs text-gray-600 text-center w-full px-1 space-y-0.5",children:[(0,o.jsx)("div",{className:"truncate",children:(null===(l=q.before[e.id])||void 0===l?void 0:null===(t=l.exifData)||void 0===t?void 0:t.captureDate)?"Снято: ".concat(new Date(q.before[e.id].exifData.captureDate).toLocaleDateString("ru-RU")):(null===(a=q.before[e.id])||void 0===a?void 0:null===(r=a.exifData)||void 0===r?void 0:r.reason)?"Снято: ".concat(q.before[e.id].exifData.reason.includes("No EXIF")?"отсутствует инфо. Скриншот или корректированное фото":q.before[e.id].exifData.reason):"Снято: отсутствует инфо"}),(0,o.jsxs)("div",{className:"truncate",children:["\uD83D\uDCE4 ",new Date(q.before[e.id].uploadDate).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,o.jsx)("p",{className:"text-sm font-medium text-blue-800 text-center whitespace-pre-line mt-1",children:e.label})]}),(0,o.jsxs)("div",{className:"flex flex-col items-center",children:[(0,o.jsx)("div",{className:"w-full aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-blue-300 mb-2 relative group",children:U.after[e.id]?(0,o.jsxs)("div",{className:"w-full h-full relative",children:[(0,o.jsx)("img",{src:U.after[e.id],alt:"После",className:"w-full h-full object-contain"}),(0,o.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-200 flex flex-col items-center justify-center gap-2",children:[(0,o.jsxs)("label",{className:"text-white font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer hover:underline",children:["Изменить",(0,o.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:j,onChange:t=>{var l;let o=null===(l=t.target.files)||void 0===l?void 0:l[0];o&&ee("after",e.id,o)}})]}),(0,o.jsx)("button",{onClick:()=>et("after",e.id),className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:underline",disabled:j,children:"Корректировать"})]})]}):(0,o.jsxs)("label",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-gray-200 transition",children:[(0,o.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:j,onChange:t=>{var l;let o=null===(l=t.target.files)||void 0===l?void 0:l[0];o&&ee("after",e.id,o)}}),(0,o.jsx)("span",{className:"text-blue-600 font-medium",children:j?"Обработка...":"загрузить"})]})}),q.after[e.id]&&(0,o.jsxs)("div",{className:"text-[11px] sm:text-xs text-gray-600 text-center w-full px-1 space-y-0.5",children:[(0,o.jsx)("div",{className:"truncate",children:(null===(s=q.after[e.id])||void 0===s?void 0:null===(n=s.exifData)||void 0===n?void 0:n.captureDate)?"Снято: ".concat(new Date(q.after[e.id].exifData.captureDate).toLocaleDateString("ru-RU")):(null===(c=q.after[e.id])||void 0===c?void 0:null===(i=c.exifData)||void 0===i?void 0:i.reason)?"Снято: ".concat(q.after[e.id].exifData.reason.includes("No EXIF")?"отсутствует инфо. Скриншот или корректированное фото":q.after[e.id].exifData.reason):"Снято: отсутствует инфо"}),(0,o.jsxs)("div",{className:"truncate",children:["\uD83D\uDCE4 ",new Date(q.after[e.id].uploadDate).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,o.jsx)("p",{className:"text-sm font-medium text-blue-800 text-center whitespace-pre-line mt-1",children:e.label})]})]},e.id)})}),(0,o.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,o.jsx)("div",{className:"text-sm font-medium text-blue-800",children:"Бот определил возраст"}),(0,o.jsx)("input",{type:"text",value:U.botAgeBefore||"",readOnly:!0,placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"}),(0,o.jsx)("input",{type:"text",value:U.botAgeAfter||"",readOnly:!0,placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,o.jsx)("div",{className:"text-sm font-medium text-blue-800",children:"возраст"}),(0,o.jsx)("input",{type:"number",value:U.realAgeBefore||"",onChange:e=>z(t=>({...t,realAgeBefore:parseInt(e.target.value)||null})),placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"}),(0,o.jsx)("input",{type:"number",value:U.realAgeAfter||"",onChange:e=>z(t=>({...t,realAgeAfter:parseInt(e.target.value)||null})),placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,o.jsx)("div",{className:"text-sm font-medium text-blue-800",children:"вес"}),(0,o.jsx)("input",{type:"number",value:U.weightBefore||"",onChange:e=>z(t=>({...t,weightBefore:parseInt(e.target.value)||null})),placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"}),(0,o.jsx)("input",{type:"number",value:U.weightAfter||"",onChange:e=>z(t=>({...t,weightAfter:parseInt(e.target.value)||null})),placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,o.jsx)("div",{className:"text-sm font-medium text-blue-800",children:"рост"}),(0,o.jsx)("input",{type:"number",value:U.heightBefore||"",onChange:e=>z(t=>({...t,heightBefore:parseInt(e.target.value)||null})),placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"}),(0,o.jsx)("input",{type:"number",value:U.heightAfter||"",onChange:e=>z(t=>({...t,heightAfter:parseInt(e.target.value)||null})),placeholder:"...",className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-center"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,o.jsx)("div",{className:"text-sm font-medium text-blue-800",children:"комментарий"}),(0,o.jsx)("textarea",{value:U.commentBefore,onChange:e=>z(t=>({...t,commentBefore:e.target.value})),placeholder:"...",rows:3,className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg resize-none"}),(0,o.jsx)("textarea",{value:U.commentAfter,onChange:e=>z(t=>({...t,commentAfter:e.target.value})),placeholder:"...",rows:3,className:"w-full px-3 py-2 border-2 border-blue-300 rounded-lg resize-none"})]})]}),(0,o.jsxs)("div",{className:"mt-8 flex flex-col items-center gap-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[(0,o.jsxs)("button",{onClick:eo,disabled:j,className:"flex items-center px-8 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-bold rounded-lg transition",children:["скачать коллаж",(0,o.jsx)("svg",{className:"ml-2 h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})})]}),(0,o.jsxs)("button",{onClick:()=>{confirm("Удалить все загруженные фотографии? Это действие нельзя отменить.")&&(z({before:{front:null,left34:null,leftProfile:null,right34:null,rightProfile:null,closeup:null},after:{front:null,left34:null,leftProfile:null,right34:null,rightProfile:null,closeup:null},botAgeBefore:null,botAgeAfter:null,realAgeBefore:null,realAgeAfter:null,weightBefore:null,weightAfter:null,heightBefore:null,heightAfter:null,commentBefore:"",commentAfter:""}),(null==t?void 0:t._id)&&localStorage.removeItem("photo_diary_".concat(t._id)),alert("Все фотографии удалены"))},className:"flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition",children:["Очистить всё",(0,o.jsx)("svg",{className:"ml-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]})]}),(0,o.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,o.jsx)("svg",{className:"h-4 w-4 mr-1 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Фотографии автоматически сохраняются"]}),(0,o.jsx)("div",{id:"storage-policy-detail",className:"mt-6 bg-blue-50 border-2 border-blue-300 rounded-lg p-4",children:(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,o.jsxs)("div",{className:"flex-1 text-sm text-blue-800 space-y-2",children:[(0,o.jsx)("p",{className:"font-bold text-base",children:"Хранение фотографий и автосохранение:"}),(0,o.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"В браузере:"})," сжатые копии оригиналов (50% качество) хранятся локально 24 часа для предпросмотра в окне корректировки обрезки"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"На сервере - оригиналы:"})," необрезанные фото (100% качество) хранятся 1 день для возможности коррекции обрезки"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"На сервере - обрезанные:"})," финальные фото для коллажа хранятся 1 месяц бесплатно, потом автоматически удаляются"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"С оплаченным курсом:"})," хранение на всё время курса + 1 месяц после его окончания"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"Уведомления:"})," мы пришлём напоминания о удалении фото за 7, 3 и 1 день. Вы сможете продлить хранение, оформив курс"]})]})]})]})})]})]}),m&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto p-6",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold text-blue-800",children:"Правила фотодневника"}),(0,o.jsx)("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700",children:(0,o.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,o.jsxs)("div",{className:"space-y-4 text-blue-800",children:[(0,o.jsx)("p",{className:"font-bold",children:"Проверьте, как вы выглядите сейчас. Сделайте снимок и загрузите его, посмотрите результат."}),(0,o.jsx)("p",{children:"Наш Age-bot угадает, сколько лет выглядит ваше лицо сейчас. Точность работы Age-bot очень высока - 95% результатов корректны."}),(0,o.jsx)("p",{children:"Можно ли обмануть его? Нет... и да. Age-bot видит возрастные изменения в структуре костей - это невозможно подделать! Но он также проверяет состояние и расположение ваших мягких тканей. Это мы можем улучшить в приложении Rejuvena."})]}),(0,o.jsx)("div",{className:"mt-6 flex justify-end",children:(0,o.jsx)("button",{onClick:()=>x(!1),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg",children:"Понятно"})})]})}),E&&P&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-auto",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg p-4 w-auto max-w-[95vw] max-h-[95vh] flex flex-col",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-blue-800",children:"Корректировать обрезку"}),(0,o.jsx)("button",{onClick:()=>{I(!1),_(null)},className:"text-gray-500 hover:text-gray-700",children:(0,o.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,o.jsx)("div",{className:"mb-3 overflow-auto flex-shrink",children:(0,o.jsxs)("div",{className:"relative inline-block",children:[(0,o.jsx)("img",{src:P.dataUrl,alt:"Crop preview",className:"border-2 border-gray-300 crop-modal-image",style:{display:"block",maxWidth:"85vw",maxHeight:"60vh",width:"auto",height:"auto"},onLoad:e=>{let t=e.target,l=t.width-F.width,o=t.height-F.height;F.x>l&&R(e=>({...e,x:Math.max(0,l)})),F.y>o&&R(e=>({...e,y:Math.max(0,o)}))}}),(0,o.jsx)("div",{className:"absolute border-4 border-blue-500 cursor-move",style:{left:"".concat(F.x,"px"),top:"".concat(F.y,"px"),width:"".concat(F.width,"px"),height:"".concat(F.height,"px"),boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)",touchAction:"none"},onMouseDown:e=>{var t;e.preventDefault();let l=null===(t=e.currentTarget.parentElement)||void 0===t?void 0:t.querySelector("img");if(!l)return;let o=l.width,r=l.height,a=l.getBoundingClientRect(),n=e.clientX-a.left-F.x,s=e.clientY-a.top-F.y,i=e=>{let t=Math.max(0,Math.min(o-F.width,e.clientX-a.left-n)),l=Math.max(0,Math.min(r-F.height,e.clientY-a.top-s));R(e=>({...e,x:t,y:l}))},c=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",c)},onTouchStart:e=>{var t;e.preventDefault();let l=null===(t=e.currentTarget.parentElement)||void 0===t?void 0:t.querySelector("img");if(!l)return;let o=l.width,r=l.height,a=l.getBoundingClientRect(),n=e.touches[0],s=n.clientX-a.left-F.x,i=n.clientY-a.top-F.y,c=e=>{e.preventDefault();let t=e.touches[0],l=Math.max(0,Math.min(o-F.width,t.clientX-a.left-s)),n=Math.max(0,Math.min(r-F.height,t.clientY-a.top-i));R(e=>({...e,x:l,y:n}))},d=()=>{document.removeEventListener("touchmove",c),document.removeEventListener("touchend",d)};document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",d)},children:(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm font-bold",style:{textShadow:"0 0 4px black"},children:"Перетащите"})})]})}),(0,o.jsx)("div",{className:"space-y-3 mb-4 flex-shrink-0",children:(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Размер области обрезки: ",F.width,"\xd7",F.height,"px (квадрат)"]}),(0,o.jsx)("input",{type:"range",min:"100",max:(()=>{let e=document.querySelector(".relative.inline-block img");return e?Math.min(e.width,e.height):1e3})(),step:"10",value:F.width,onChange:e=>{let t=document.querySelector(".relative.inline-block img");if(!t)return;let l=Math.min(parseInt(e.target.value),Math.min(t.width,t.height));R(e=>({...e,width:l,height:l,x:Math.min(e.x,t.width-l),y:Math.min(e.y,t.height-l)}))},className:"w-full"}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Область обрезки всегда остаётся квадратной"})]})}),(0,o.jsxs)("div",{className:"flex justify-end gap-2 flex-shrink-0",children:[(0,o.jsx)("button",{onClick:()=>{I(!1),_(null)},className:"px-4 py-2 border-2 border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50",children:"Отмена"}),(0,o.jsx)("button",{onClick:el,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg",children:"Сохранить"})]})]})})]})]})}},4902:function(){},522:function(){},753:function(){}},function(e){e.O(0,[269,791,888,774,179],function(){return e(e.s=7049)}),_N_E=e.O()}]);