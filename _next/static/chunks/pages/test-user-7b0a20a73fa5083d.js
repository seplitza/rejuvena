(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[442],{8406:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-user",function(){return t(3373)}])},3373:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return c}});var r=t(5893),a=t(7294),l=t(1163),n=t(9133),i=t(3031);function c(){let e=(0,l.useRouter)(),s=(0,n.T)(),[t,c]=(0,a.useState)("idle"),[d,m]=(0,a.useState)("test"),[o,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{var e,s;if(null===(e=window.Telegram)||void 0===e?void 0:e.WebApp){let e=window.Telegram.WebApp;e.ready(),e.expand();let t=null===(s=e.initDataUnsafe)||void 0===s?void 0:s.user;if(t){let e={id:"tg-".concat(t.id),email:t.username?"".concat(t.username,"@telegram.user"):"user".concat(t.id,"@telegram.user"),name:"".concat(t.first_name).concat(t.last_name?" "+t.last_name:""),firstName:t.first_name,lastName:t.last_name||"",username:t.username||"",telegramId:t.id,photoUrl:t.photo_url,isPremium:t.is_premium,languageCode:t.language_code};u(e),m("telegram"),console.log("✅ Обнаружен Telegram пользователь:",e);return}}let t=new URLSearchParams(window.location.search),r=t.get("tg_user_id")||t.get("tg_id"),a=t.get("tg_username"),l=t.get("tg_first_name")||t.get("first_name"),n=t.get("tg_last_name")||t.get("last_name");if(r){let e={id:"tg-".concat(r),email:a?"".concat(a,"@telegram.user"):"user".concat(r,"@telegram.user"),name:"".concat(l||"Пользователь").concat(n?" "+n:""),firstName:l||"Пользователь",lastName:n||"",username:a||"",telegramId:parseInt(r),needsFullAccess:!l||!a};u(e),m("manual"),console.log("✅ Создан пользователь из URL параметров (Deep Link):",e);return}u({id:"test-user-12345",email:"test@rejuvena.ru",name:"Тестовый Пользователь",firstName:"Тестовый",lastName:"Пользователь"}),m("test")},[]);let g=t=>{try{c("creating");let r="".concat(d,"-token-").concat(Date.now());s((0,i.uB)(r)),s((0,i.av)(t)),localStorage.setItem("rejuvena_auth",JSON.stringify({isAuthenticated:!0,token:r,user:t,loading:!1,error:null})),localStorage.setItem("rejuvena_user",JSON.stringify(t)),console.log("✅ Пользователь создан:",t),c("success"),setTimeout(()=>{e.push("/photo-diary")},2e3)}catch(e){console.error("❌ Ошибка создания пользователя:",e),c("error")}};return(0,a.useEffect)(()=>{o&&("telegram"===d||"true"===e.query.auto)&&setTimeout(()=>{g(o)},500)},[o,e.query]),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-blue-600 mb-6",children:"telegram"===d?"\uD83D\uDCF1 Вход через Telegram":"manual"===d?"\uD83D\uDD17 Вход по ссылке":"\uD83E\uDDEA Тестовый вход"}),"telegram"===d&&(0,r.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6",children:[(0,r.jsx)("p",{className:"font-semibold text-blue-800",children:"✅ Обнаружен Telegram аккаунт"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Вход будет выполнен автоматически через ваш Telegram профиль"})]}),"manual"===d&&(0,r.jsxs)("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 mb-6",children:[(0,r.jsx)("p",{className:"font-semibold text-green-800",children:"✅ Получены данные из ссылки"}),(0,r.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"Нажмите кнопку ниже для входа в приложение"})]}),"test"===d&&(0,r.jsxs)("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6",children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"Инструкция:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm",children:[(0,r.jsx)("li",{children:'Нажмите кнопку "Войти в приложение"'}),(0,r.jsx)("li",{children:"Дождитесь подтверждения создания"}),(0,r.jsx)("li",{children:"Автоматически будет выполнен вход и переход в Фотодневник"})]})]}),o&&(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 font-mono text-sm",children:[(0,r.jsx)("p",{className:"font-bold mb-2",children:"Данные пользователя:"}),o.username&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Telegram:"})," ",(0,r.jsxs)("strong",{children:["@",o.username]})]}),o.telegramId&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Telegram ID:"})," ",(0,r.jsx)("strong",{children:o.telegramId})]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Email:"})," ",(0,r.jsx)("strong",{children:o.email})]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Имя:"})," ",(0,r.jsx)("strong",{children:o.name})]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"User ID:"})," ",(0,r.jsx)("strong",{children:o.id})]})]}),"idle"===t&&o&&(0,r.jsx)("button",{onClick:()=>g(o),className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition",children:"telegram"===d?"\uD83D\uDCF1 Войти через Telegram":"manual"===d?"\uD83D\uDD17 Войти в приложение":"\uD83E\uDDEA Войти как тестовый пользователь"}),"creating"===t&&(0,r.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-yellow-600 mr-3"}),(0,r.jsx)("span",{className:"text-yellow-800",children:"Создание пользователя..."})]})}),"success"===t&&(0,r.jsx)("div",{className:"bg-green-50 border-l-4 border-green-500 p-4",children:(0,r.jsxs)("p",{className:"text-green-800",children:["✅ ",(0,r.jsx)("strong",{children:"Вход выполнен успешно!"}),(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"text-sm",children:"Переход в Фотодневник..."})]})}),"error"===t&&(0,r.jsxs)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:[(0,r.jsxs)("p",{className:"text-red-800",children:["❌ ",(0,r.jsx)("strong",{children:"Ошибка создания пользователя"}),(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"text-sm",children:"Проверьте консоль браузера для деталей"})]}),(0,r.jsx)("button",{onClick:()=>o&&g(o),className:"mt-3 bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition text-sm",children:"Попробовать снова"})]}),(0,r.jsxs)("div",{className:"mt-8 bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"font-semibold mb-2 text-sm text-gray-700",children:"\uD83D\uDCCB Способы использования:"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"1. Через Telegram Bot:"}),(0,r.jsxs)("p",{className:"text-gray-600 mt-1",children:["Добавьте скрипт Telegram WebApp на страницу и откройте через бота.",(0,r.jsx)("br",{}),"Пользователь будет определен автоматически."]}),(0,r.jsx)("code",{className:"block bg-gray-800 text-green-400 p-2 mt-2 rounded text-xs",children:"https://seplitza.github.io/rejuvena/test-user?auto=true"})]}),(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("strong",{children:"2. Через URL параметры (для тестирования):"}),(0,r.jsx)("code",{className:"block bg-gray-800 text-green-400 p-2 mt-2 rounded text-xs overflow-x-auto",children:"https://seplitza.github.io/rejuvena/test-user?auto=true\n&tg_id=123456789\n&tg_username=username\n&tg_first_name=Ivan\n&tg_last_name=Petrov"})]}),(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("strong",{children:"3. Тестовый режим (по умолчанию):"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Просто откройте страницу без параметров для тестового пользователя"})]})]})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("a",{href:"/",className:"text-blue-600 hover:underline text-sm",children:"← Вернуться на главную"})})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8406)}),_N_E=e.O()}]);