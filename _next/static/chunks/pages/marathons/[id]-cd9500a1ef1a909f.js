(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{158:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/marathons/[id]",function(){return i(2781)}])},1807:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var n=i(5893),o=i(7294),r=i(5871);function a(e){let{isOpen:t,onClose:i,productType:a,productId:s,productName:l,price:d,onPaymentSuccess:c}=e,[p,x]=(0,o.useState)(!1),[u,h]=(0,o.useState)(null);(0,o.useEffect)(()=>{t||(h(null),x(!1))},[t]);let g=async()=>{try{var e;x(!0),h(null);let t=localStorage.getItem("auth_token");if(!t)throw Error("Требуется авторизация");let i="",n={};"premium"===a?(i="".concat(r.T,"/api/payment/create"),n={amount:d,description:"Премиум подписка",planType:"premium",duration:30}):"exercise"===a?(i="".concat(r.T,"/api/payment/create-exercise"),n={exerciseId:s,exerciseName:l,price:d}):"marathon"===a&&(i="".concat(r.T,"/api/payment/create-marathon"),n={marathonId:s,marathonName:l,price:d});let o=await fetch(i,{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok){let e=await o.json();throw Error(e.error||"Ошибка при создании платежа")}let c=await o.json();if(!(null===(e=c.payment)||void 0===e?void 0:e.paymentUrl))throw Error("Не получена ссылка для оплаты");window.location.href=c.payment.paymentUrl}catch(e){console.error("Payment error:",e),h(e instanceof Error?e.message:"Произошла ошибка при оплате")}finally{x(!1)}};return t?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{onClick:i,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9998,padding:"20px"},children:(0,n.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{background:"white",borderRadius:"16px",maxWidth:"500px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",zIndex:9999},children:[(0,n.jsxs)("div",{style:{padding:"24px",borderBottom:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsxs)("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#111827",margin:0},children:[(()=>{switch(a){case"premium":return"⭐";case"exercise":return"\uD83D\uDCAA";case"marathon":return"\uD83C\uDFC3";default:return"\uD83D\uDCB3"}})()," Оплата"]}),(0,n.jsx)("button",{onClick:i,disabled:p,style:{background:"transparent",border:"none",fontSize:"24px",cursor:p?"not-allowed":"pointer",color:"#6B7280",padding:"4px"},children:"\xd7"})]}),(0,n.jsxs)("div",{style:{padding:"24px"},children:[(0,n.jsxs)("div",{style:{background:"#F9FAFB",padding:"20px",borderRadius:"12px",marginBottom:"24px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",color:"#6B7280",marginBottom:"8px"},children:(()=>{switch(a){case"premium":return"Премиум подписка";case"exercise":return"Упражнение";case"marathon":return"Марафон";default:return"Покупка"}})()}),(0,n.jsx)("div",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",marginBottom:"16px"},children:l}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"16px",borderTop:"1px solid #E5E7EB"},children:[(0,n.jsx)("div",{style:{fontSize:"16px",color:"#6B7280"},children:"Итого к оплате:"}),(0,n.jsxs)("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#4F46E5"},children:[d," ₽"]})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"12px"},children:"Способ оплаты"}),(0,n.jsxs)("div",{style:{padding:"16px",border:"2px solid #4F46E5",borderRadius:"8px",display:"flex",alignItems:"center",gap:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"24px"},children:"\uD83D\uDCB3"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"15px",fontWeight:"600",color:"#111827"},children:"Альфа-банк"}),(0,n.jsx)("div",{style:{fontSize:"13px",color:"#6B7280"},children:"Банковская карта (Visa, MasterCard, МИР)"})]})]})]}),u&&(0,n.jsxs)("div",{style:{padding:"12px 16px",background:"#FEE2E2",border:"1px solid #FCA5A5",borderRadius:"8px",color:"#DC2626",fontSize:"14px",marginBottom:"20px"},children:["❌ ",u]}),(0,n.jsx)("div",{style:{padding:"16px",background:"#EEF2FF",borderRadius:"8px",marginBottom:"24px"},children:(0,n.jsxs)("div",{style:{fontSize:"13px",color:"#4F46E5",lineHeight:"1.6"},children:['ℹ️ После нажатия кнопки "Оплатить" вы будете перенаправлены на защищённую страницу оплаты Альфа-банка.',"marathon"===a&&" После успешной оплаты вы будете автоматически записаны на марафон.","exercise"===a&&" После успешной оплаты упражнение станет доступным в течение 30 дней.","premium"===a&&" После успешной оплаты премиум-доступ будет активирован на 30 дней."]})}),(0,n.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,n.jsx)("button",{onClick:i,disabled:p,style:{flex:1,padding:"14px",background:"#F3F4F6",color:"#374151",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:p?"not-allowed":"pointer",opacity:p?.5:1},children:"Отмена"}),(0,n.jsx)("button",{onClick:g,disabled:p,style:{flex:2,padding:"14px",background:p?"#9CA3AF":"#4F46E5",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:p?"not-allowed":"pointer",transition:"background 0.2s"},children:p?"Загрузка...":"Оплатить ".concat(d," ₽")})]})]})]})})}):null}},5871:function(e,t,i){"use strict";i.d(t,{P:function(){return o},T:function(){return n}});let n="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:9527":"https://api-rejuvena.duckdns.org",o={exercises:{public:"".concat(n,"/api/exercises/public"),byId:e=>"".concat(n,"/api/exercises/").concat(e)},courses:{public:"".concat(n,"/api/courses/public"),byId:e=>"".concat(n,"/api/courses/").concat(e)},payment:{create:"".concat(n,"/api/payment/create"),status:e=>"".concat(n,"/api/payment/status/").concat(e)}}},2781:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var n=i(5893),o=i(7294),r=i(1163),a=i(9133),s=i(5871),l=i(1807);function d(){let e=(0,r.useRouter)(),{id:t}=e.query,{isAuthenticated:i,user:d}=(0,a.C)(e=>e.auth),[c,p]=(0,o.useState)(null),[x,u]=(0,o.useState)([]),[h,g]=(0,o.useState)(null),[y,m]=(0,o.useState)(!0),[f,b]=(0,o.useState)(!1),[j,v]=(0,o.useState)(null),[w,D]=(0,o.useState)(!1),[S,B]=(0,o.useState)("info");(0,o.useEffect)(()=>{t&&(E(),k(),i&&z())},[t,i]);let E=async()=>{try{let e=await fetch("".concat(s.T,"/api/marathons/").concat(t));if(!e.ok)throw Error("Failed to load marathon");let i=await e.json();p(i)}catch(e){console.error("Error loading marathon:",e),v("Не удалось загрузить марафон")}finally{m(!1)}},k=async()=>{try{let e=await fetch("".concat(s.T,"/api/marathons/").concat(t,"/days"));if(!e.ok)throw Error("Failed to load days");let i=await e.json();u(i.days||[])}catch(e){console.error("Error loading days:",e)}},z=async()=>{try{let e=localStorage.getItem("auth_token");if(!e)return;let i=await fetch("".concat(s.T,"/api/marathons/").concat(t,"/progress"),{headers:{Authorization:"Bearer ".concat(e)}});if(i.ok){let e=await i.json();g(e.enrollment)}}catch(e){console.error("Error loading enrollment:",e)}},C=async()=>{if(!i){e.push("/signin");return}if((null==c?void 0:c.isPaid)&&!(null==h?void 0:h.isPaid)){D(!0);return}try{b(!0);let e=localStorage.getItem("auth_token"),i=await fetch("".concat(s.T,"/api/marathons/").concat(t,"/enroll"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!i.ok){let e=await i.json();throw Error(e.message||"Не удалось записаться")}await z(),alert("✅ Вы успешно записались на марафон!")}catch(e){console.error("Error enrolling:",e),alert(e instanceof Error?e.message:"Ошибка при записи")}finally{b(!1)}},F=i=>{if(!h){alert("Сначала запишитесь на марафон");return}if(!i.isAvailable){alert("Этот день ещё не доступен. Он откроется по расписанию.");return}e.push("/marathons/".concat(t,"/day/").concat(i.dayNumber))},T=e=>e%10==1&&e%100!=11?"день":[2,3,4].includes(e%10)&&![12,13,14].includes(e%100)?"дня":"дней",R=e=>{let t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long",year:"numeric"}).format(t)};if(y)return(0,n.jsx)("div",{style:{padding:"40px",textAlign:"center"},children:(0,n.jsx)("div",{style:{fontSize:"18px",color:"#6B7280"},children:"Загрузка..."})});if(j||!c)return(0,n.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,n.jsxs)("div",{style:{fontSize:"18px",color:"#DC2626",marginBottom:"16px"},children:["❌ ",j||"Марафон не найден"]}),(0,n.jsx)("button",{onClick:()=>e.push("/marathons"),style:{padding:"10px 20px",background:"#4F46E5",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:"Вернуться к списку"})]});let A=(()=>{if(!c)return{text:"",color:"",daysRemaining:0};let e=new Date,t=new Date(c.startDate),i=new Date(t.getTime()+864e5*c.tenure);if(e<t){let i=Math.ceil((t.getTime()-e.getTime())/864e5);return{text:"Начнётся через ".concat(i," ").concat(T(i)),color:"#F59E0B",daysRemaining:i}}if(e>i)return{text:"Завершён",color:"#6B7280",daysRemaining:0};let n=Math.floor((e.getTime()-t.getTime())/864e5);return{text:"День ".concat(n+1),color:"#10B981",daysRemaining:c.tenure-n-1}})();return(0,n.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"40px 20px"},children:[(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",padding:"40px",color:"white",marginBottom:"32px",position:"relative",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{position:"absolute",top:"20px",right:"20px",background:A.color,padding:"8px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"600"},children:A.text}),(0,n.jsx)("h1",{style:{fontSize:"42px",fontWeight:"bold",marginBottom:"16px",paddingRight:"150px"},children:c.title}),(0,n.jsxs)("div",{style:{display:"flex",gap:"32px",marginBottom:"24px",fontSize:"16px",opacity:.95},children:[(0,n.jsxs)("div",{children:["\uD83D\uDCC5 Старт: ",R(c.startDate)]}),(0,n.jsxs)("div",{children:["⏱️ Продолжительность: ",c.tenure," ",T(c.tenure)]}),(0,n.jsxs)("div",{children:["\uD83D\uDCAA Упражнений: ",c.numberOfDays]})]}),h&&(0,n.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.2)",padding:"16px",borderRadius:"12px",marginBottom:"24px"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",marginBottom:"8px",opacity:.9},children:"Ваш прогресс"}),(0,n.jsxs)("div",{style:{display:"flex",gap:"24px",alignItems:"center"},children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[h.completedDays.length,"/",c.numberOfDays]}),(0,n.jsx)("div",{style:{fontSize:"13px",opacity:.9},children:"дней завершено"})]}),(0,n.jsx)("div",{style:{flex:1,height:"8px",background:"rgba(255, 255, 255, 0.3)",borderRadius:"4px",overflow:"hidden"},children:(0,n.jsx)("div",{style:{height:"100%",width:"".concat(h.completedDays.length/c.numberOfDays*100,"%"),background:"white",borderRadius:"4px",transition:"width 0.3s"}})})]})]}),h?"pending"===h.status?(0,n.jsx)("div",{style:{padding:"14px 32px",background:"rgba(251, 191, 36, 0.2)",color:"white",borderRadius:"12px",fontSize:"16px",fontWeight:"600",display:"inline-block"},children:"⏳ Ожидание оплаты"}):(0,n.jsx)("div",{style:{padding:"14px 32px",background:"rgba(16, 185, 129, 0.2)",color:"white",borderRadius:"12px",fontSize:"16px",fontWeight:"600",display:"inline-block"},children:"✓ Вы участвуете в марафоне"}):(0,n.jsx)("button",{onClick:C,disabled:f,style:{padding:"14px 32px",background:"white",color:"#667eea",border:"none",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:f?"not-allowed":"pointer",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",opacity:f?.7:1},children:f?"Записываем...":c.isPaid?"Записаться за ".concat(c.cost,"₽"):"Записаться бесплатно"})]}),(0,n.jsx)("div",{style:{borderBottom:"2px solid #E5E7EB",marginBottom:"32px"},children:(0,n.jsx)("div",{style:{display:"flex",gap:"0"},children:[{id:"info",label:"\uD83D\uDCD6 Описание"},{id:"days",label:"\uD83D\uDCC5 Программа"},{id:"rules",label:"\uD83D\uDCCB Правила"}].map(e=>(0,n.jsx)("button",{onClick:()=>B(e.id),style:{padding:"12px 24px",background:"transparent",border:"none",borderBottom:S===e.id?"2px solid #4F46E5":"2px solid transparent",color:S===e.id?"#4F46E5":"#6B7280",cursor:"pointer",fontWeight:S===e.id?"600":"400",fontSize:"16px",marginBottom:"-2px",transition:"all 0.2s"},children:e.label},e.id))})}),(0,n.jsxs)("div",{style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:["info"===S&&(0,n.jsxs)("div",{children:[c.welcomeMessage&&(0,n.jsxs)("div",{style:{marginBottom:"32px"},children:[(0,n.jsx)("h2",{style:{fontSize:"24px",fontWeight:"600",marginBottom:"16px"},children:"Добро пожаловать!"}),(0,n.jsx)("div",{style:{fontSize:"16px",lineHeight:"1.7",color:"#374151"},dangerouslySetInnerHTML:{__html:c.welcomeMessage}})]}),c.courseDescription&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{fontSize:"24px",fontWeight:"600",marginBottom:"16px"},children:"О марафоне"}),(0,n.jsx)("div",{style:{fontSize:"16px",lineHeight:"1.7",color:"#374151"},dangerouslySetInnerHTML:{__html:c.courseDescription}})]}),c.hasContest&&(0,n.jsxs)("div",{style:{marginTop:"32px",padding:"24px",background:"#FEF3C7",borderRadius:"12px",border:"1px solid #FDE68A"},children:[(0,n.jsx)("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#92400E",marginBottom:"12px"},children:"\uD83C\uDFC6 В этом марафоне проводится конкурс!"}),(0,n.jsxs)("div",{style:{fontSize:"15px",color:"#78350F",lineHeight:"1.6"},children:[c.contestStartDate&&(0,n.jsxs)("div",{children:["Конкурс: ",R(c.contestStartDate)," - ",c.contestEndDate&&R(c.contestEndDate)]}),c.votingStartDate&&(0,n.jsxs)("div",{children:["Голосование: ",R(c.votingStartDate)," - ",c.votingEndDate&&R(c.votingEndDate)]})]})]})]}),"days"===S&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{fontSize:"24px",fontWeight:"600",marginBottom:"24px"},children:"Программа марафона"}),0===x.length?(0,n.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#6B7280"},children:"Программа скоро появится"}):(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:x.map(e=>(0,n.jsxs)("div",{onClick:()=>F(e),style:{padding:"20px",border:e.isAvailable?"2px solid #10B981":"1px solid #E5E7EB",borderRadius:"12px",cursor:e.isAvailable?"pointer":"not-allowed",background:e.isAvailable?"#F0FDF4":"#F9FAFB",opacity:e.isAvailable?1:.6,transition:"all 0.2s"},onMouseEnter:t=>{e.isAvailable&&(t.currentTarget.style.transform="translateX(4px)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateX(0)"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",marginBottom:"4px"},children:["День ",e.dayNumber]}),(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#6B7280"},children:["learning"===e.dayType?"\uD83D\uDCDA Обучение":"\uD83C\uDFCB️ Практика"," • ",e.exercises.length," упражнений"]})]}),(null==h?void 0:h.completedDays.includes(e.dayNumber))&&(0,n.jsx)("div",{style:{padding:"4px 12px",background:"#10B981",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"600"},children:"✓ Завершён"}),!e.isAvailable&&(0,n.jsx)("div",{style:{padding:"4px 12px",background:"#6B7280",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"600"},children:"\uD83D\uDD12 Заблокирован"})]}),e.description&&(0,n.jsx)("p",{style:{fontSize:"14px",color:"#374151",margin:0},children:e.description})]},e._id))})]}),"rules"===S&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{fontSize:"24px",fontWeight:"600",marginBottom:"16px"},children:"Правила марафона"}),c.rules?(0,n.jsx)("div",{style:{fontSize:"16px",lineHeight:"1.7",color:"#374151"},dangerouslySetInnerHTML:{__html:c.rules}}):(0,n.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#6B7280"},children:"Правила будут добавлены позже"})]})]}),w&&c.isPaid&&(0,n.jsx)(l.Z,{isOpen:w,onClose:()=>D(!1),productType:"marathon",productId:c._id,productName:c.title,price:c.cost,onPaymentSuccess:()=>{D(!1),z()}})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=158)}),_N_E=e.O()}]);