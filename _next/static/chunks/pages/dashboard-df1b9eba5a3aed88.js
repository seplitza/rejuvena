(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{528:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(6401)}])},6401:function(e,s,t){"use strict";t.r(s);var a=t(5893),l=t(7294),r=t(1163),n=t(9133),i=t(3031),c=t(803),d=t(8256),o=t(7963),x=t(74);let m=e=>{let s=e.metadata;return s?"premium"===s.type||"premium"===s.planType?"Покупка: Премиум доступ":("marathon"===s.type||"marathon"===s.planType)&&s.marathonName?'Покупка: марафон "'.concat(s.marathonName,'"'):("exercise"===s.type||"exercise"===s.planType)&&s.exerciseName?'Покупка: упражнение "'.concat(s.exerciseName,'"'):"Покупка":"Покупка"};s.default=()=>{let e=(0,r.useRouter)(),s=(0,n.T)(),{user:t,isAuthenticated:u}=(0,n.C)(e=>e.auth),[h,p]=(0,l.useState)([]),[g,j]=(0,l.useState)([]),[N,f]=(0,l.useState)({});return((0,l.useEffect)(()=>{u||e.push("/auth/login")},[u,e]),(0,l.useEffect)(()=>{let e=async()=>{try{let e=await c.WY.get(d.fI);e.payments&&p(e.payments.slice(0,5))}catch(e){console.error("Failed to load payments:",e)}},s=async()=>{try{let e=localStorage.getItem("auth_token");if(console.log("\uD83C\uDFC3 Loading my enrollments, token:",e?"exists":"missing"),!e)return;let s=await fetch("".concat("https://api-rejuvena.duckdns.org","/api/marathons/user/my-enrollments"),{headers:{Authorization:"Bearer ".concat(e)}});if(console.log("\uD83D\uDCE1 My-enrollments response status:",s.status),s.ok){let e=await s.json();if(console.log("\uD83D\uDCE6 My-enrollments data:",e),e.success&&Array.isArray(e.enrollments)){let s=e.enrollments.map(e=>e.marathonId).filter(Boolean);console.log("\uD83C\uDFAF Setting enrolled marathons:",s.length,s),j(s)}else console.warn("⚠️ Unexpected enrollments format:",e)}else console.error("❌ My-enrollments API error:",s.status,s.statusText)}catch(e){console.error("\uD83D\uDCA5 Failed to load marathons:",e)}};u&&(console.log("\uD83D\uDD0D Dashboard user data:",{isPremium:null==t?void 0:t.isPremium,premiumEndDate:null==t?void 0:t.premiumEndDate,premiumEndDateType:typeof(null==t?void 0:t.premiumEndDate),fullUser:t}),e(),s())},[u,t]),(0,l.useEffect)(()=>{if(0===g.length)return;let e=()=>{let e={};g.forEach(s=>{let t=new Date().getTime(),a=new Date(s.startDate).getTime()-t;a<0?e[s._id]={days:0,hours:0,minutes:0,seconds:0,hasStarted:!0}:e[s._id]={days:Math.floor(a/864e5),hours:Math.floor(a%864e5/36e5),minutes:Math.floor(a%36e5/6e4),seconds:Math.floor(a%6e4/1e3),hasStarted:!1}}),f(e)};e();let s=setInterval(e,1e3);return()=>clearInterval(s)},[g]),u)?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8 flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Личный кабинет"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(o.Z,{}),(0,a.jsx)("button",{onClick:()=>{u&&(s((0,i.kS)()),c.VH.remove()),e.push("/auth/login")},className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:u?"Выйти":"Войти"})]})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:["Добро пожаловать, ",(null==t?void 0:t.firstName)||"Гость","!"]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Email: ",(null==t?void 0:t.email)||"Не указан"]})]}),(null==t?void 0:t.isPremium)&&(0,a.jsx)("div",{className:"mb-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg shadow-lg p-6 text-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-2",children:"✨ Премиум доступ активен"}),(0,a.jsxs)("p",{className:"text-purple-100",children:["Активен до: ",(null==t?void 0:t.premiumEndDate)?new Date(t.premiumEndDate).toLocaleDateString("ru-RU"):"неизвестно"]}),(null==t?void 0:t.premiumEndDate)&&(0,a.jsxs)("p",{className:"text-purple-100 mt-1",children:["Осталось дней: ",Math.max(0,Math.ceil((new Date(t.premiumEndDate).getTime()-new Date().getTime())/864e5))]}),(0,a.jsx)("p",{className:"text-purple-100 mt-1",children:"\uD83C\uDFAF Разблокирован доступ ко всем упражнениям"})]}),(0,a.jsx)("div",{className:"text-6xl",children:"\uD83D\uDC51"})]})}),g.length>0&&(0,a.jsx)("div",{className:"mb-6 space-y-4",children:g.map(s=>{var t;let l=N[s._id],r=null===(t=null==l?void 0:l.hasStarted)||void 0===t||t;return(0,a.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-pink-500 rounded-lg shadow-lg p-6 text-white cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>e.push("/marathons/".concat(s._id,"/start")),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold",children:["\uD83C\uDFAF ",s.title]}),(0,a.jsx)("span",{className:"text-xs bg-white/30 px-3 py-1 rounded-full font-semibold",children:"Марафон оплачен"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-orange-100 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDCC5"}),(0,a.jsxs)("span",{children:["Длительность обучения: ",s.numberOfDays," дней"]})]}),(0,a.jsxs)("p",{className:"text-orange-100 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83C\uDFC3"}),(0,a.jsx)("span",{children:"Курс практики: 30 дней"})]}),(0,a.jsxs)("p",{className:"text-orange-100 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDDD3️"}),(0,a.jsxs)("span",{children:["Старт: ",new Date(s.startDate).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]}),!r&&l&&(0,a.jsxs)("div",{className:"mt-4 bg-white/20 rounded-lg p-4 backdrop-blur-sm",children:[(0,a.jsx)("p",{className:"text-sm font-semibold mb-2",children:"⏰ До старта марафона:"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:l.days}),(0,a.jsx)("div",{className:"text-xs text-orange-200",children:"дней"})]}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:":"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:String(l.hours).padStart(2,"0")}),(0,a.jsx)("div",{className:"text-xs text-orange-200",children:"часов"})]}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:":"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:String(l.minutes).padStart(2,"0")}),(0,a.jsx)("div",{className:"text-xs text-orange-200",children:"минут"})]}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:":"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:String(l.seconds).padStart(2,"0")}),(0,a.jsx)("div",{className:"text-xs text-orange-200",children:"секунд"})]})]})]}),r&&(0,a.jsx)("div",{className:"mt-2 text-orange-100",children:"✨ Разблокирован доступ ко всем упражнениям марафона"})]})]}),(0,a.jsxs)("div",{className:"ml-6 flex-shrink-0",children:[(0,a.jsx)("div",{className:"text-7xl mb-2",children:"\uD83C\uDFC3"}),(0,a.jsx)("button",{className:"bg-white text-orange-600 font-bold px-6 py-3 rounded-lg hover:bg-orange-50 transition-colors whitespace-nowrap",children:r?"Начать марафон →":"Подробнее →"})]})]})},s._id)})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(x.Z,{})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors text-left group border border-purple-200",onClick:()=>e.push("/courses"),children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCDA"}),(0,a.jsx)("span",{className:"text-base font-medium text-gray-800 group-hover:text-purple-600",children:"Мои курсы"})]}),(0,a.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors text-left group border border-purple-200",onClick:()=>e.push("/exercises"),children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83C\uDFCB️"}),(0,a.jsx)("span",{className:"text-base font-medium text-gray-800 group-hover:text-purple-600",children:"Упражнения"})]}),(0,a.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors text-left group border border-purple-200",onClick:()=>e.push("/photo-diary"),children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCF8"}),(0,a.jsx)("span",{className:"text-base font-medium text-gray-800 group-hover:text-purple-600",children:"Фото-дневник"})]}),(0,a.jsxs)("button",{className:"flex items-center space-x-3 p-4 rounded-lg bg-purple-50 hover:bg-purple-100 transition-colors text-left group border border-purple-200",onClick:()=>e.push("/profile/settings"),children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDC64"}),(0,a.jsx)("span",{className:"text-base font-medium text-gray-800 group-hover:text-purple-600",children:"Профиль"})]})]})}),u&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Последняя активность"}),0===h.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-gray-400 text-5xl mb-2",children:"\uD83D\uDCED"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Активности пока нет"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Начните с выбора курса!"})]}):(0,a.jsx)("div",{className:"space-y-3",children:h.map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>"succeeded"===s.status&&e.push("/payment/success?orderId=".concat(s.id)),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-2xl",children:"succeeded"===s.status?"✅":"processing"===s.status?"⏳":"failed"===s.status?"❌":"⏸️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"succeeded"===s.status?"Оплата принята":"processing"===s.status?"Обработка оплаты":"failed"===s.status?"Оплата не прошла":"Ожидание оплаты"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:m(s)})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-gray-800",children:[s.amount," ₽"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleDateString("ru-RU")})]})]},s.id))})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Загрузка..."})]})})}}},function(e){e.O(0,[692,471,888,774,179],function(){return e(e.s=528)}),_N_E=e.O()}]);