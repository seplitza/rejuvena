"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[441],{4675:function(e,t,r){r.d(t,{Z:function(){return c}});var o=r(5893),l=r(645),i=r.n(l),s=r(7294),n=r(5675),a=r.n(n);function d(e){var t,r,o,l,i,s,n,a;if(!e)return{embedUrl:"",type:"iframe"};if(e.match(/\.(mp4|webm|ogg|mov)$/i))return{embedUrl:e,type:"video"};if(e.includes("player.vimeo.com/video/")){let r=null===(t=e.split("player.vimeo.com/video/")[1])||void 0===t?void 0:t.split("?")[0];return{embedUrl:"https://player.vimeo.com/video/".concat(r,"?title=0&byline=0&portrait=0&badge=0&autopause=0&player_id=0&dnt=1&controls=1&transparent=0"),type:"iframe"}}if(e.includes("youtube.com/embed/")){let t=null===(r=e.split("youtube.com/embed/")[1])||void 0===r?void 0:r.split("?")[0];return{embedUrl:"https://www.youtube.com/embed/".concat(t,"?modestbranding=1&rel=0&showinfo=0&fs=1&controls=1&disablekb=0&iv_load_policy=3&cc_load_policy=0&playsinline=1&enablejsapi=1&origin=").concat(encodeURIComponent(window.location.origin)),type:"iframe"}}if(e.includes("rutube.ru/play/embed/")||e.includes("vk.com/video_ext.php")||e.includes("dzen.ru/embed/"))return{embedUrl:e,type:"iframe"};if(e.includes("youtube.com")||e.includes("youtu.be")){let t=e.includes("youtu.be")?null===(o=e.split("youtu.be/")[1])||void 0===o?void 0:o.split("?")[0]:new URL(e).searchParams.get("v");return{embedUrl:"https://www.youtube.com/embed/".concat(t,"?modestbranding=1&rel=0&showinfo=0&fs=1&controls=1&disablekb=0&iv_load_policy=3&cc_load_policy=0&playsinline=1&enablejsapi=1&origin=").concat(encodeURIComponent(window.location.origin)),type:"iframe"}}if(e.includes("vimeo.com")&&!e.includes("player.vimeo.com")){let t=null===(l=e.split("vimeo.com/")[1])||void 0===l?void 0:l.split("?")[0];return{embedUrl:"https://player.vimeo.com/video/".concat(t,"?title=0&byline=0&portrait=0&badge=0&autopause=0&player_id=0&dnt=1&controls=1&transparent=0"),type:"iframe"}}if(e.includes("rutube.ru")){let t=null===(i=e.split("rutube.ru/video/")[1])||void 0===i?void 0:i.split("?")[0];return t||(t=null===(s=e.split("rutube.ru/play/embed/")[1])||void 0===s?void 0:s.split("?")[0]),{embedUrl:"https://rutube.ru/play/embed/".concat(t),type:"iframe"}}if(e.includes("vk.com/video")){let t=e.match(/video(-?\d+)_(\d+)/);if(t){let[,e,r]=t;return{embedUrl:"https://vk.com/video_ext.php?oid=".concat(e,"&id=").concat(r),type:"iframe"}}}if(e.includes("dzen.ru")){let t=(null===(n=e.split("dzen.ru/video/watch/")[1])||void 0===n?void 0:n.split("?")[0])||(null===(a=e.split("dzen.ru/embed/")[1])||void 0===a?void 0:a.split("?")[0]);if(t)return{embedUrl:"https://dzen.ru/embed/".concat(t),type:"iframe"}}return e.includes("t.me"),{embedUrl:e,type:"iframe"}}function c(e){var t,r;let{exercise:l,isOpen:n,onClose:c,onCheckboxChange:u,isDone:p}=e,[m,h]=(0,s.useState)(!1),[x,b]=(0,s.useState)(0),[v,g]=(0,s.useState)([]),[y,f]=(0,s.useState)(!1),[w,j]=(0,s.useState)(!1),k=(0,s.useRef)(null);if((0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&c()};return n&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[n,c]),(0,s.useEffect)(()=>{if(!n||!k.current)return;let e=setTimeout(()=>{let e=k.current;e&&(e.scrollHeight>e.clientHeight+10||w||(console.log("\uD83D\uDCDC Content is short, no scroll needed - auto-completing description"),j(!0)))},300);return()=>clearTimeout(e)},[n,l,v]),(0,s.useEffect)(()=>{if(!l)return;let e=[...l.exerciseContents||[]].sort((e,t)=>(e.order||0)-(t.order||0)).filter(e=>"video"===e.type||"image"===e.type).map(e=>{let t={id:e.id||Math.random().toString(),type:e.type,contentPath:e.contentPath,loadError:!1};if("video"===e.type){let{embedUrl:r,type:o}=d(e.contentPath);t.embedUrl=r,t.videoType=o}return t});if(0===e.length){let t=l.imageUrl||l.imageUrl,r=l.videoUrl||l.videoUrl;if(t&&e.push({id:"fallback-image",type:"image",contentPath:t,loadError:!1}),r){let{embedUrl:t,type:o}=d(r);e.push({id:"fallback-video",type:"video",contentPath:r,embedUrl:t,videoType:o,loadError:!1})}}g(e),b(0),f(!1),j(!1)},[l]),(0,s.useEffect)(()=>{if(p||!u)return;let e=l.exerciseDescription||"",t=l.description||"",r=l.content||"",o=l.marathonExerciseDescription||"",i=!(v.length>0&&"video"===v[0].type)||y,s=!(e||t||r||o)||w;i&&s&&(console.log("✅ Auto-completing exercise: video watched and description scrolled"),u(!0))},[y,w,p,u,l,v]),(0,s.useEffect)(()=>{let e=e=>{if(e.data&&"string"==typeof e.data)try{let t=JSON.parse(e.data);"ended"===t.event&&0===x&&(console.log("\uD83C\uDFA5 YouTube video watched to end (via postMessage)"),f(!0))}catch(e){}e.data&&"object"==typeof e.data&&"ended"===e.data.event&&0===x&&(console.log("\uD83C\uDFA5 Vimeo video watched to end (via postMessage)"),f(!0)),e.data&&"object"==typeof e.data&&"player:ended"===e.data.type&&0===x&&(console.log("\uD83C\uDFA5 RuTube video watched to end (via postMessage)"),f(!0))};return n&&window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[n,x]),!n||!l)return null;let N=l.exerciseName||"",F=l.marathonExerciseName||"",C=l.exerciseDescription||"",D=l.description||"",E=l.content||"",L=l.marathonExerciseDescription||"",M=D.length>C.length?D:C;E.length>M.length&&(M=E),L.length>M.length&&(M=L),M&&(M=M.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}](?:\u{FE0F}|\u{200D}[\u{1F3FB}-\u{1F3FF}]?)?/gu,e=>e.replace(/[\uFE0F\u200D]/g,"")));let U=/<\/?[a-z][\s\S]*>/i.test(M),_=l.type||"",z=l.duration||0,P=!!l.isNew,T=v.filter(e=>!e.loadError),B=T[x],S=e=>{g(t=>t.map((t,r)=>r===e?{...t,loadError:!0}:t))};return(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm md:p-4",children:(0,o.jsxs)("div",{className:"relative w-full h-full md:max-w-3xl md:max-h-[90vh] md:h-auto bg-white md:rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[(0,o.jsx)("div",{className:"text-white p-3 md:p-4 flex-shrink-0",style:{backgroundImage:"linear-gradient(to right, var(--color-primary), var(--color-secondary))"},children:(0,o.jsxs)("div",{className:"flex items-start justify-between",children:[(0,o.jsxs)("div",{className:"flex-1 pr-2",children:[(0,o.jsx)("h2",{className:"text-lg md:text-xl font-bold mb-0.5",children:N}),F&&(0,o.jsx)("p",{className:"text-sm opacity-90",children:F}),(_||z>0)&&(0,o.jsxs)("div",{className:"flex items-center space-x-2 mt-2 text-xs",children:[_&&(0,o.jsx)("span",{className:"flex items-center space-x-1 bg-white/20 px-2 py-0.5 rounded-full",children:(0,o.jsx)("span",{children:"Video"===_?"Видео":"Reading"===_?"Теория":"Практика"})}),z>0&&(0,o.jsx)("span",{className:"flex items-center space-x-1 bg-white/20 px-2 py-0.5 rounded-full",children:(0,o.jsxs)("span",{children:[Math.floor(z/60)," мин"]})})]})]}),u&&(0,o.jsx)("button",{onClick:()=>{P||u(!p)},disabled:P,className:"flex-shrink-0 w-6 h-6 rounded-md border-2 border-white/50 hover:border-white transition-colors flex items-center justify-center mr-2 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":p?"Отметить как невыполненное":"Отметить как выполненное",children:p&&(0,o.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,o.jsx)("button",{onClick:c,className:"flex-shrink-0 p-1.5 hover:bg-white/10 rounded-lg transition-colors","aria-label":"Закрыть",children:(0,o.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,o.jsxs)("div",{ref:k,className:"flex-1 overflow-y-auto",onScroll:e=>{let t=e.currentTarget;t.scrollHeight-t.scrollTop<=t.clientHeight+50&&!w&&(console.log("\uD83D\uDCDC Description scrolled to end"),j(!0))},children:[T.length>0&&(0,o.jsx)("div",{className:"flex flex-col items-center py-4",style:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))"},children:(0,o.jsx)("div",{className:"w-full max-w-[400px] px-4 md:px-0",children:(0,o.jsxs)("div",{className:"relative w-full",children:[(null==B?void 0:B.type)==="image"&&(0,o.jsx)("div",{className:"absolute top-4 left-4 right-4 z-10",children:(0,o.jsxs)("div",{className:"text-white text-sm px-4 py-2.5 rounded-lg text-center shadow-lg",style:{backgroundColor:"var(--color-primary, #9333ea)",opacity:.95},children:[(0,o.jsx)("p",{className:"font-semibold mb-1",children:"\uD83D\uDCA1 Основное движение"}),(0,o.jsxs)("p",{className:"text-xs opacity-90",children:["Ознакомьтесь с видео инструкцией",T.length>1&&", нажмите на стрелочку вправо"]})]})}),B&&(0,o.jsx)("div",{className:"w-full",children:"video"===B.type?"video"===B.videoType?(0,o.jsx)("video",{src:B.embedUrl,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",disablePictureInPicture:!0,className:"w-full aspect-square object-contain bg-white rounded-lg",playsInline:!0,onError:()=>S(x),onEnded:()=>{0===x&&(console.log("\uD83C\uDFA5 First video watched to end"),f(!0))},onContextMenu:e=>e.preventDefault()}):(0,o.jsxs)("div",{className:"jsx-100156e96e85fe95 w-full aspect-square bg-white rounded-lg overflow-hidden relative",children:[(0,o.jsx)("iframe",{src:B.embedUrl,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onError:()=>S(x),className:"jsx-100156e96e85fe95 w-full h-full"}),(0,o.jsx)("div",{style:{height:"20%",zIndex:10},onClick:e=>e.stopPropagation(),className:"jsx-100156e96e85fe95 absolute top-0 left-0 right-0 pointer-events-auto bg-transparent"}),(null===(t=B.embedUrl)||void 0===t?void 0:t.includes("youtube.com"))?(0,o.jsx)("div",{style:{right:"48px",width:"100px",height:"48px",zIndex:10},onClick:e=>e.stopPropagation(),className:"jsx-100156e96e85fe95 absolute bottom-0 pointer-events-auto bg-transparent"}):(null===(r=B.embedUrl)||void 0===r?void 0:r.includes("vimeo.com"))?(0,o.jsx)("div",{style:{width:"80px",height:"80px",zIndex:10},onClick:e=>e.stopPropagation(),className:"jsx-100156e96e85fe95 absolute bottom-0 right-0 pointer-events-auto bg-transparent"}):null,(0,o.jsx)(i(),{id:"100156e96e85fe95",children:'.vp-sidedock,.vp-title,.vp-byline,.vp-portrait,.vp-badge,.vp-sidedock-button{display:none!important;opacity:0!important;visibility:hidden!important}iframe[src*="youtube.com"] .ytp-title,iframe[src*="youtube.com"] .ytp-chrome-top,iframe[src*="youtube.com"] .ytp-show-cards-title,iframe[src*="youtube.com"] .ytp-watermark{display:none!important;pointer-events:none!important}'})]}):(0,o.jsx)("div",{className:"w-full aspect-square flex items-center justify-center bg-white rounded-lg p-4",children:(0,o.jsx)("div",{className:"relative w-1/2 h-1/2",children:(0,o.jsx)(a(),{src:B.contentPath,alt:N,fill:!0,className:"object-contain",onError:()=>S(x)})})})},B.id),T.length>1&&(0,o.jsxs)(o.Fragment,{children:[x>0&&(0,o.jsx)("button",{onClick:()=>{b(e=>Math.max(0,e-1))},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all z-10","aria-label":"Предыдущее",children:(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),x<T.length-1&&(0,o.jsx)("button",{onClick:()=>{b(e=>Math.min(T.length-1,e+1))},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all z-10","aria-label":"Следующее",children:(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,o.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-10",children:T.map((e,t)=>(0,o.jsx)("button",{onClick:()=>b(t),className:"w-2 h-2 rounded-full transition-all ".concat(t===x?"bg-white w-6":"bg-white/50 hover:bg-white/75"),"aria-label":"Перейти к ".concat(t+1)},t))})]})]})})}),M&&(0,o.jsx)("div",{className:"p-4 md:p-6",children:U?(0,o.jsx)("div",{className:"prose prose-sm max-w-none prose-headings:font-bold prose-p:text-gray-700 prose-p:leading-relaxed prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-strong:font-semibold prose-ul:list-disc prose-ol:list-decimal prose-li:text-gray-700 prose-li:my-1 prose-blockquote:border-l-4 prose-blockquote:pl-4 prose-blockquote:italic",style:{"--tw-prose-headings":"var(--color-text-primary, #581c87)","--tw-prose-links":"var(--color-primary, #9333ea)","--tw-prose-quote-borders":"var(--color-primary-border, rgba(147, 51, 234, 0.5))"},dangerouslySetInnerHTML:{__html:M}}):(0,o.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed whitespace-pre-line",children:M})}),(0,o.jsxs)("div",{className:"border-t border-gray-200 bg-gray-50",children:[(0,o.jsxs)("button",{onClick:()=>h(!m),className:"w-full px-4 md:px-6 py-3 flex items-center justify-between hover:bg-gray-100 transition-colors",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,o.jsx)("span",{className:"text-base font-semibold text-gray-900",children:"Комментарии"}),(0,o.jsx)("span",{className:"text-sm text-gray-500",children:"(скоро)"})]}),(0,o.jsx)("svg",{className:"w-5 h-5 text-gray-500 transition-transform ".concat(m?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m&&(0,o.jsx)("div",{className:"px-4 md:px-6 pb-6 pt-2",children:(0,o.jsx)("div",{className:"text-sm text-gray-500 text-center py-8 bg-white rounded-lg border border-gray-200",children:"\uD83D\uDCDD Раздел комментариев будет доступен в следующей версии"})})]})]}),(0,o.jsx)("div",{className:"flex-shrink-0 border-t border-gray-200 px-4 md:px-6 py-3 bg-white",children:(0,o.jsx)("button",{onClick:c,className:"w-full px-6 py-2.5 text-white font-medium rounded-lg transition-colors",style:{backgroundColor:"var(--color-primary)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Закрыть"})})]})})}},3224:function(e,t,r){r.d(t,{Z:function(){return l}});var o=r(5893);function l(e){let{exercise:t,uniqueId:r,isDone:l,isChanging:i,onToggle:s,onCheck:n}=e,{exerciseName:a,marathonExerciseName:d,isNew:c,blockExercise:u}=t,p=u||i||c;return(0,o.jsx)("div",{className:"border-2 rounded-lg transition-all ".concat(u?"bg-gray-100 border-gray-300":c?"bg-green-50 border-green-300":l?"border-2":"bg-white border-gray-200"," ").concat(u?"opacity-60 cursor-not-allowed":"hover:shadow-md"),style:!l||u||c?{}:{backgroundColor:"var(--color-primary-light, rgba(147, 51, 234, 0.1))",borderColor:"var(--color-primary-border, rgba(147, 51, 234, 0.3))"},children:(0,o.jsxs)("div",{className:"flex items-center p-3 space-x-3",children:[(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),p||n()},disabled:p,className:"flex-shrink-0 w-6 h-6 rounded border-2 flex items-center justify-center transition-all ".concat(p?"border-gray-300 cursor-not-allowed":"border-gray-400"),style:!p&&l?{backgroundColor:"var(--color-primary)",borderColor:"var(--color-primary)"}:{},onMouseEnter:e=>{p||l||(e.currentTarget.style.borderColor="var(--color-primary)")},onMouseLeave:e=>{p||l||(e.currentTarget.style.borderColor="")},children:i?(0,o.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderBottomColor:"var(--color-primary)"}}):l?(0,o.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):null}),(0,o.jsx)("button",{onClick:s,disabled:u,className:"flex-1 text-left min-w-0 ".concat(u?"cursor-not-allowed":"cursor-pointer"),children:(0,o.jsxs)("p",{className:"text-sm font-medium ".concat(u?"text-gray-400":l?"text-gray-500":"text-gray-900"," truncate"),children:[(0,o.jsx)("span",{className:"font-bold",children:a})," ",d]})}),c&&!u&&(0,o.jsx)("span",{className:"flex-shrink-0 px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded-full",children:"Новое"})]})})}}}]);