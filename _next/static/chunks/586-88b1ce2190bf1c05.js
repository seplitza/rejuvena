"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[586],{3586:function(r,e,t){t.d(e,{Z:function(){return n}});var o=t(5893),i=t(7294),a=t(9473);function n(r){let{exerciseId:e,marathonId:t,marathonDayNumber:n,context:l="exercise"}=r,{token:c}=(0,a.v9)(r=>r.auth),s="https://api-rejuvena.duckdns.org",[d,p]=(0,i.useState)([]),[x,u]=(0,i.useState)(!0),[g,m]=(0,i.useState)("all"),[h,y]=(0,i.useState)(""),[v,b]=(0,i.useState)(!1),[f,B]=(0,i.useState)(!1),[j,F]=(0,i.useState)(null),[S,k]=(0,i.useState)("");(0,i.useEffect)(()=>{c&&w()},[g,e,t,n,c]);let w=async()=>{try{u(!0);let r=new URLSearchParams({filter:g,...e&&{exerciseId:e},...t&&{marathonId:t},...n&&{marathonDayNumber:n.toString()}}),o=await fetch("".concat(s,"/api/comments?").concat(r),{headers:{Authorization:"Bearer ".concat(c),"Content-Type":"application/json"}}),i=await o.json();i.success&&p(i.comments)}catch(r){console.error("Error loading comments:",r)}finally{u(!1)}},D=async()=>{if(h.trim())try{B(!0);let r=await fetch("".concat(s,"/api/comments"),{method:"POST",headers:{Authorization:"Bearer ".concat(c),"Content-Type":"application/json"},body:JSON.stringify({content:h,isPrivate:v,exerciseId:e,marathonId:t,marathonDayNumber:n})}),o=await r.json();o.success?(y(""),b(!1),alert(o.message||"Комментарий отправлен!"),w()):alert(o.error||"Ошибка отправки комментария")}catch(r){console.error("Error submitting comment:",r),alert("Ошибка отправки комментария")}finally{B(!1)}},C=async r=>{if(S.trim())try{let o=await fetch("".concat(s,"/api/comments"),{method:"POST",headers:{Authorization:"Bearer ".concat(c),"Content-Type":"application/json"},body:JSON.stringify({content:S,parentCommentId:r,isPrivate:!1,exerciseId:e,marathonId:t,marathonDayNumber:n})}),i=await o.json();i.success&&(k(""),F(null),alert(i.message||"Ответ отправлен!"),w())}catch(r){console.error("Error submitting reply:",r),alert("Ошибка отправки ответа")}},z=async r=>{try{await fetch("".concat(s,"/api/comments/").concat(r,"/like"),{method:"POST",headers:{Authorization:"Bearer ".concat(c),"Content-Type":"application/json"}}),w()}catch(r){console.error("Error liking comment:",r)}},E=r=>new Date(r).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=r=>r.firstName||r.lastName?"".concat(r.firstName||""," ").concat(r.lastName||"").trim():"Пользователь";return(0,o.jsxs)("div",{style:{marginTop:"40px"},children:[(0,o.jsx)("h3",{style:{fontSize:"24px",fontWeight:"bold",marginBottom:"24px",color:"var(--color-text-primary, #1F2937)"},children:"Комментарии"}),(0,o.jsxs)("div",{style:{display:"flex",gap:"8px",borderBottom:"2px solid var(--color-border, #E5E7EB)",marginBottom:"24px"},children:[(0,o.jsx)("button",{onClick:()=>m("all"),style:{padding:"12px 24px",background:"transparent",border:"none",borderBottom:"3px solid ".concat("all"===g?"var(--color-primary, #3B82F6)":"transparent"),color:"all"===g?"var(--color-primary, #3B82F6)":"var(--color-text-secondary, #6B7280)",fontWeight:"all"===g?"600":"400",cursor:"pointer",fontSize:"15px",marginBottom:"-2px"},children:"Все комментарии"}),(0,o.jsx)("button",{onClick:()=>m("exercise"),style:{padding:"12px 24px",background:"transparent",border:"none",borderBottom:"3px solid ".concat("exercise"===g?"var(--color-primary, #3B82F6)":"transparent"),color:"exercise"===g?"var(--color-primary, #3B82F6)":"var(--color-text-secondary, #6B7280)",fontWeight:"exercise"===g?"600":"400",cursor:"pointer",fontSize:"15px",marginBottom:"-2px"},children:"По упражнению"}),(0,o.jsx)("button",{onClick:()=>m("private"),style:{padding:"12px 24px",background:"transparent",border:"none",borderBottom:"3px solid ".concat("private"===g?"var(--color-primary, #3B82F6)":"transparent"),color:"private"===g?"var(--color-primary, #3B82F6)":"var(--color-text-secondary, #6B7280)",fontWeight:"private"===g?"600":"400",cursor:"pointer",fontSize:"15px",marginBottom:"-2px"},children:"\uD83D\uDD12 Личные с тренером"})]}),(0,o.jsxs)("div",{style:{background:"var(--color-surface, #FFFFFF)",border:"1px solid var(--color-border, #E5E7EB)",borderRadius:"12px",padding:"20px",marginBottom:"24px"},children:[(0,o.jsx)("textarea",{value:h,onChange:r=>y(r.target.value),placeholder:v?"Написать тренеру (личное сообщение)...":"Напишите комментарий...",rows:4,style:{width:"100%",padding:"12px",border:"1px solid var(--color-border, #D1D5DB)",borderRadius:"8px",fontSize:"15px",marginBottom:"12px",resize:"vertical",fontFamily:"inherit"}}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",color:"var(--color-text-secondary, #6B7280)"},children:[(0,o.jsx)("input",{type:"checkbox",checked:v,onChange:r=>b(r.target.checked),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:"var(--color-primary, #3B82F6)"}}),"Личное сообщение тренеру"]}),(0,o.jsx)("button",{onClick:D,disabled:!h.trim()||f,style:{padding:"12px 24px",background:h.trim()&&!f?"var(--color-primary, #3B82F6)":"var(--color-neutral-300, #D1D5DB)",color:"white",border:"none",borderRadius:"8px",cursor:h.trim()&&!f?"pointer":"not-allowed",fontSize:"15px",fontWeight:"600"},children:f?"Отправка...":"Отправить"})]}),v&&(0,o.jsx)("div",{style:{marginTop:"12px",padding:"12px",background:"var(--color-warning-light, #FEF3C7)",borderRadius:"8px",fontSize:"13px",color:"var(--color-warning-dark, #92400E)"},children:"\uD83D\uDCA1 Личные сообщения видны только вам и тренеру"})]}),x?(0,o.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"var(--color-text-secondary, #6B7280)"},children:"Загрузка комментариев..."}):0===d.length?(0,o.jsxs)("div",{style:{textAlign:"center",padding:"60px 20px",color:"var(--color-text-secondary, #6B7280)",background:"var(--color-surface, #F9FAFB)",borderRadius:"12px"},children:[(0,o.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\uD83D\uDCAC"}),(0,o.jsx)("div",{style:{fontSize:"16px",fontWeight:"500"},children:"private"===g?"У вас пока нет личных сообщений с тренером":"Пока нет комментариев. Будьте первым!"})]}):(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:d.map(r=>(0,o.jsxs)("div",{style:{background:"var(--color-surface, #FFFFFF)",border:"1px solid var(--color-border, #E5E7EB)",borderRadius:"12px",padding:"20px"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"12px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{fontWeight:"600",color:"var(--color-text-primary, #1F2937)",marginBottom:"4px"},children:[A(r.userId),r.isPrivate&&(0,o.jsx)("span",{style:{marginLeft:"8px",padding:"2px 8px",background:"var(--color-warning-light, #FEF3C7)",color:"var(--color-warning-dark, #92400E)",borderRadius:"4px",fontSize:"11px",fontWeight:"600"},children:"\uD83D\uDD12 ЛИЧНОЕ"})]}),(0,o.jsxs)("div",{style:{fontSize:"13px",color:"var(--color-text-tertiary, #9CA3AF)"},children:[E(r.createdAt),r.isEdited&&" (отредактировано)"]})]}),(0,o.jsxs)("button",{onClick:()=>z(r._id),style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 12px",background:"var(--color-neutral-100, #F3F4F6)",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:["❤️ ",r.likes]})]}),(0,o.jsx)("div",{style:{fontSize:"15px",lineHeight:"1.6",color:"var(--color-text-primary, #1F2937)",marginBottom:"12px",whiteSpace:"pre-wrap"},children:r.content}),!r.isPrivate&&(0,o.jsx)("button",{onClick:()=>F(j===r._id?null:r._id),style:{padding:"6px 12px",background:"transparent",color:"var(--color-primary, #3B82F6)",border:"1px solid var(--color-primary, #3B82F6)",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:j===r._id?"Отмена":"Ответить"}),j===r._id&&(0,o.jsxs)("div",{style:{marginTop:"16px",padding:"16px",background:"var(--color-neutral-50, #F9FAFB)",borderRadius:"8px"},children:[(0,o.jsx)("textarea",{value:S,onChange:r=>k(r.target.value),placeholder:"Напишите ответ...",rows:3,style:{width:"100%",padding:"10px",border:"1px solid var(--color-border, #D1D5DB)",borderRadius:"6px",fontSize:"14px",marginBottom:"10px",resize:"vertical",fontFamily:"inherit"}}),(0,o.jsx)("button",{onClick:()=>C(r._id),disabled:!S.trim(),style:{padding:"8px 16px",background:S.trim()?"var(--color-primary, #3B82F6)":"var(--color-neutral-300, #D1D5DB)",color:"white",border:"none",borderRadius:"6px",cursor:S.trim()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Отправить"})]}),r.replies&&r.replies.length>0&&(0,o.jsx)("div",{style:{marginTop:"16px",paddingLeft:"20px",borderLeft:"3px solid var(--color-primary-light, #DBEAFE)"},children:r.replies.map(r=>(0,o.jsxs)("div",{style:{marginTop:"12px",padding:"12px",background:"var(--color-neutral-50, #F9FAFB)",borderRadius:"8px"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{style:{fontWeight:"600",fontSize:"14px",color:"var(--color-text-primary, #1F2937)"},children:A(r.userId)}),(0,o.jsx)("span",{style:{marginLeft:"8px",fontSize:"12px",color:"var(--color-text-tertiary, #9CA3AF)"},children:E(r.createdAt)})]}),(0,o.jsxs)("button",{onClick:()=>z(r._id),style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",background:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px"},children:["❤️ ",r.likes]})]}),(0,o.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.5",color:"var(--color-text-secondary, #4B5563)",whiteSpace:"pre-wrap"},children:r.content})]},r._id))})]},r._id))})]})}}}]);